<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[Docker-02-åˆ›å»ºmysqlå®¹å™¨]]></title>
    <url>%2F2019%2F03%2F10%2Fdocker%2FDocker-02-%E5%88%9B%E5%BB%BAmysql%E5%AE%B9%E5%99%A8%2F</url>
    <content type="text"><![CDATA[1. å‰è¨€æˆ‘ä»¬åœ¨å·¥ä½œä¸­ä¼šæœ‰éœ€è¦åœ¨æœ¬æœºå®‰è£…mysqlï¼Œä½†æ˜¯ç‹¬ç«‹å»å®‰è£…mysqlä¼šè€—è´¹å¾ˆå¤§çš„å†…å­˜ä»¥åŠç£ç›˜ç©ºé—´ï¼Œå¦‚æœæ˜¯åœ¨è‡ªå·±çš„ç”µè„‘ä¸Šæ—¶é—´ä¹…äº†å¯èƒ½ä¼šä½¿ç”µè„‘è¶Šæ¥è¶Šå¡ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬åœ¨ç”µè„‘ä¸Šå®‰è£…äº†dockeré‚£å°±ä¸ä¸€æ ·äº†ï¼Œæˆ–è€…æˆ‘ä»¬è´­ä¹°äº†äº‘ä¸»æœºï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸»æœºä¸Šè‡ªå·±å®‰è£…mysqlï¼Œä½†æ˜¯æ™®é€šçš„æŒ‰ä½æ­¥éª¤å¤ªç¹çï¼Œè€Œä¸”ä¸€èˆ¬åªèƒ½å¯ç”¨ä¸€ä¸ªmysqlï¼Œè¿™æ—¶å€™Dockerå°±ç«™å‡ºæ¥å•¦ã€‚ä¸ªäººæ¯”è¾ƒæ¨èä½¿ç”¨dockerï¼Œå› ä¸ºçœŸçš„æ˜¯å¤ªå¥½ç”¨äº†ï¼Œå¥½ç”¨åˆ°çˆ±ä¸é‡Šæ‰‹ã€‚å˜»å˜»~ã€‚æˆ‘ä»¬ä¸ä»…å¯ä»¥ä½¿ç”¨dockerè¿˜å¯ä»¥å®‰è£…å¾ˆå¤šå®ç”¨çš„å·¥å…·ï¼Œä½ å¯ä»¥åˆ°dockerHubä¸Šå»æŸ¥æ‰¾ä½ éœ€è¦çš„é•œåƒã€‚ 2. å‡†å¤‡å·¥ä½œ2.1 å®‰è£…Dockeræ— è®ºä½ æ˜¯Windowsè¿˜æ˜¯Macè¿˜æ˜¯Linuxï¼Œç°åœ¨ç½‘ä¸Šéƒ½æœ‰å¾ˆå¤šå®‰è£…æ•™ç¨‹ï¼Œä½ å¯ä»¥æ ¹æ®æ­¥éª¤è¿›è¡Œå®‰è£…ï¼Œè¿™é‡Œæˆ‘ä»¬å°±å½“Dockerå·²ç»å®‰è£…å®Œå•¦ã€‚ 2.2 æ‹‰å–mysqlçš„é•œåƒ(è¿™é‡Œä½¿ç”¨mysql5.7)1$ docker pull mysql:5.7 2.3 å¯åŠ¨mysqlå½“æˆ‘ä»¬ä»é•œåƒä»“åº“æ‹‰å®Œmysqlä»¥åï¼Œæœ¬åœ°æˆ–è€…æœåŠ¡å™¨ä¸Šå°±å·²ç»æœ‰äº†mysqlçš„é•œåƒï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å‘½ä»¤å»æŸ¥çœ‹1$ docker images è¿™ä¸ªå‘½ä»¤å°±åˆ—å‡ºäº†å½“å‰ä¸»æœºä¸Šå·²ç»ä¸‹è½½çš„æ‰€æœ‰é•œåƒã€‚ 2.4 åœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºæ•°æ®å­˜å‚¨æ–‡ä»¶å¤¹ä¸ªäººæ¯”è¾ƒæ¨èä½¿ç”¨dockerå®‰è£…é•œåƒä¹‹åå¯¹äºæ•°æ®è¦æœ‰è§„å¾‹çš„å»ä¿å­˜ï¼Œè¿™æ ·ä¹Ÿæ–¹ä¾¿ä»¥ååˆ é™¤é•œåƒçš„æ—¶å€™èƒ½å¤Ÿè½»æ˜“çš„æ‰¾åˆ°æ•°æ®ä¸€èµ·åˆ é™¤ã€‚æ‰€æœ‰åœ¨è¿™é‡Œæˆ‘æ‰€æœ‰ä½¿ç”¨dockerå®‰è£…çš„é•œåƒéƒ½ä¼šåœ¨/data/dockerç›®å½•ä¸‹ï¼Œdockerç›®å½•ä¸­æš—ä¸­é•œåƒå†è¿›è¡Œåˆ†ç±»ã€‚ä¾‹å¦‚ï¼šè¿™é‡Œæˆ‘è¦ä½¿ç”¨dockerå¯åŠ¨ä¸€ä¸ªmysqlçš„å®¹å™¨ å®¹å™¨åç§°ä¸ºmysql001ï¼Œè¿™æ ·æˆ‘å°±åˆ›å»ºå¦‚ä¸‹ç›®å½•1$ mkdir /data/docker/mysql/mysql001 2.5 åˆ›å»ºå®¹å™¨1$ docker run --name mysql001 -p 3306:3306 -e MYSQL_ROOT_PASSWORD=root -v /etc/localtime:/etc/localtime -v /data/docker/mysql/mysql001:/var/lib/mysql -d mysql:5.7 è¿™é‡Œæˆ‘ä»¬å¯¹ä¸Šé¢çš„å‘½ä»¤è¿›è¡Œæ‹†è§£ï¼Œæ¸…æ¥šçš„äº†è§£æ¯ä¸€æ­¥éƒ½æ˜¯åœ¨åšä»€ä¹ˆæ“ä½œã€‚ docker runè¿™æ˜¯å¯åŠ¨ä¸€ä¸ªå®¹å™¨ â€“name mysql001å¯åŠ¨çš„å®¹å™¨åç§°ä¸ºmysql001ï¼Œè¿™ä¸ªåç§°åœ¨åé¢æ“ä½œå¯ç›´æ¥ä½¿ç”¨åç§° -p 3306:3306æ˜ å°„ç«¯å£ï¼Œå‰é¢ä¸€ä¸ªç«¯å£æ˜¯å®¿ä¸»æœºçš„ç«¯å£ï¼Œåé¢ä¸€ä¸ªç«¯å£æ˜¯mysqlçš„ç«¯å£ï¼Œæˆ‘ä»¬è®¿é—®æ•°æ®åº“æ˜¯é€šè¿‡è®¿é—®å®¿ä¸»æœºå»è®¿é—®ï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ˜¯å‰é¢ä¸€ä¸ªç«¯å£ -e MYSQL_ROOT_PASSWORD=rootè®¾ç½®mysqlçš„ç™»å½•å¯†ç ä¸ºroot -v /etc/localtime:/etc/localtimeè¿™ä¸ªæ˜¯è¿™æ˜¯å¯åŠ¨å®¹å™¨çš„æ—¶åŒºå’Œå®¿ä¸»æœºä¸€è‡´ï¼Œè¿™ä¸ªè®¾ç½®æ¯”è¾ƒæœ‰ç”¨ï¼Œä¸ç„¶ä¼šå‡ºç°æ•°æ®åº“ä¸­çš„æ—¶é—´æ¯”å½“å‰æ—¶é—´æ™š8å°æ—¶ -v /data/docker/mysql/mysql001:/var/lib/mysqlè¿™ä¸ªå°±æ˜¯ç”¨åˆšåˆšåˆ›å»ºçš„ç›®å½•å»å­˜å‚¨mysqlçš„æ•°æ®äº†ï¼Œæˆ‘ä»¬åœ¨mysqlä¸­çš„æ‰€æœ‰æ•°æ®éƒ½ä¼šå­˜å‚¨åœ¨å®¿ä¸»å™¨å‰é¢çš„ç›®å½•é‡Œ -d mysql:5.7-dæ˜¯å¼€å¯Daemonæ¨¡å¼å³ä¿æŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œã€‚æœ€åçš„è¿™ä¸ªæ˜¯çŸ¥é“å¯åŠ¨å®¹å™¨çš„ç‰ˆæœ¬ å¦‚æœæ²¡æœ‰çš„è¯é»˜è®¤å°±æ˜¯latest å’Œå‰é¢pullé•œåƒæ—¶ä¸€æ · å¯åŠ¨å®¹å™¨æ‰§è¡Œå®Œä¸Šé¢çš„å‘½ä»¤åå®¹å™¨å¹¶æ²¡æœ‰å¯åŠ¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å»å¯åŠ¨å®¹å™¨1$ docker start mysql001 æˆ–è€…å°†nameä¿®æ”¹ä¸ºimage_idï¼Œimage_idå¯ä»¥é€šè¿‡ docker imageså‘½ä»¤å»æŸ¥çœ‹ã€‚ è®¿é—®mysqlæ•°æ®åº“ æ–¹å¼ä¸€ 1$ mysql-cli -h 127.0.0.1 -u root -p root æ–¹å¼äºŒä½¿ç”¨mysqlå®¢æˆ·ç«¯å¦‚ï¼šmysqlworkbatchï¼Œnavicatç­‰å®¢æˆ·ç«¯è½¯ä»¶ã€‚ åˆ é™¤å®¹å™¨åˆ é™¤å®¹å™¨å¿…é¡»è¦ä¿è¯å®¹å™¨æ˜¯stopçš„å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹ æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨ 1$ docker ps æŸ¥çœ‹æ‰€æœ‰è¿è¡Œè¿‡çš„å®¹å™¨åŒ…æ‹¬æ­£åœ¨è¿è¡Œçš„å®¹å™¨ 1$ docker ps -a æ ¹æ®ä¸Šé¢çš„å‘½ä»¤å¯ä»¥æŸ¥æ‰¾åˆ°å®¹å™¨idï¼Œæ‰§è¡Œå‘½ä»¤åˆ é™¤å®¹å™¨1$ docker rm å®¹å™¨id]]></content>
      <categories>
        <category>docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[RabbitMQå®æˆ˜]]></title>
    <url>%2F2018%2F11%2F27%2FRabbitMQ%2F</url>
    <content type="text"><![CDATA[æ¶ˆæ¯ä¸­é—´ä»¶ä»€ä¹ˆæ˜¯æ¶ˆæ¯ä¸­é—´æ¶ˆæ¯ (Message) æ˜¯æŒ‡åœ¨åº”ç”¨é—´ä¼ é€çš„æ•°æ®ã€‚æ¶ˆæ¯å¯ä»¥éå¸¸ç®€å•ï¼Œæ¯”å¦‚åªåŒ…å«æ–‡æœ¬å­—ç¬¦ä¸²ã€JSON ç­‰ï¼Œä¹Ÿå¯ä»¥å¾ˆå¤æ‚ï¼Œæ¯”å¦‚å†…åµŒå¯¹è±¡ã€‚ æ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶ (Message Queue Middlewareï¼Œç®€ç§°ä¸º MQ) æ˜¯æŒ‡åˆ©ç”¨é«˜æ•ˆå¯é çš„æ¶ˆæ¯ä¼ é€’ æœºåˆ¶è¿›è¡Œä¸å¹³å°æ— å…³çš„æ•°æ®äº¤æµï¼Œå¹¶åŸºäºæ•°æ®é€šä¿¡æ¥è¿›è¡Œåˆ†å¸ƒå¼ç³»ç»Ÿçš„é›†æˆã€‚é€šè¿‡æä¾›æ¶ˆæ¯ä¼  é€’å’Œæ¶ˆæ¯æ’é˜Ÿæ¨¡å‹ï¼Œå®ƒå¯ä»¥åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹æ‰©å±•è¿›ç¨‹é—´çš„é€šä¿¡ã€‚ æ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶ï¼Œä¹Ÿå¯ä»¥ç§°ä¸ºæ¶ˆæ¯é˜Ÿåˆ—æˆ–è€…æ¶ˆæ¯ä¸­é—´ä»¶ã€‚å®ƒä¸€èˆ¬æœ‰ä¸¤ç§ä¼ é€’æ¨¡å¼:ç‚¹å¯¹ç‚¹(P2P, Point-to-Point) æ¨¡å¼å’Œå‘å¸ƒ/è®¢é˜… (Pub/Sub) æ¨¡å¼ã€‚ç‚¹å¯¹ç‚¹æ¨¡å¼æ˜¯åŸºäºé˜Ÿåˆ—çš„ï¼Œæ¶ˆæ¯ç”Ÿäº§ è€… å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—ï¼Œæ¶ˆæ¯æ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­æ¥æ”¶æ¶ˆæ¯ï¼Œé˜Ÿåˆ—çš„å­˜åœ¨ä½¿å¾—æ¶ˆæ¯çš„å¼‚æ­¥ä¼ è¾“æˆä¸ºå¯èƒ½ã€‚ å‘å¸ƒè®¢é˜…æ¨¡å¼å®šä¹‰äº†å¦‚ä½•å‘ä¸€ä¸ªå†…å®¹èŠ‚ç‚¹å‘å¸ƒå’Œè®¢é˜…æ¶ˆæ¯ï¼Œè¿™ä¸ªå†…å®¹èŠ‚ç‚¹ç§°ä¸ºä¸»é¢˜ (topic)ï¼Œä¸» é¢˜å¯ä»¥è®¤ä¸ºæ˜¯æ¶ˆæ¯ä¼ é€’çš„ä¸­ä»‹ï¼Œæ¶ˆæ¯å‘å¸ƒè€…å°†æ¶ˆæ¯å‘å¸ƒåˆ°æŸä¸ªä¸»é¢˜ï¼Œè€Œæ¶ˆæ¯è®¢é˜…è€…åˆ™ä»ä¸»é¢˜ä¸­ è®¢é˜…æ¶ˆæ¯ã€‚ä¸»é¢˜ä½¿å¾—æ¶ˆæ¯çš„è®¢é˜…è€…ä¸æ¶ˆæ¯çš„å‘å¸ƒè€…äº’ç›¸ä¿æŒç‹¬ç«‹ï¼Œä¸éœ€è¦è¿›è¡Œæ¥è§¦å³å¯ä¿è¯æ¶ˆ æ¯çš„ä¼ é€’ï¼Œå‘å¸ƒ/è®¢é˜…æ¨¡å¼åœ¨æ¶ˆæ¯çš„ä¸€å¯¹å¤šå¹¿æ’­æ—¶é‡‡ç”¨ ã€‚ ç›®å‰å¼€æºçš„æ¶ˆæ¯ä¸­é—´ä»¶æœ‰å¾ˆå¤šï¼Œæ¯”è¾ƒä¸»æµçš„æœ‰ RabbitMQã€ Kafkaã€ ActiveMQã€ RocketMQ ç­‰ã€‚ æ¶ˆæ¯ä¸­é—´ä»¶çš„ä½œç”¨æ¶ˆæ¯ä¸­é—´ä»¶å‡­å€Ÿå…¶ç‹¬åˆ°çš„ç‰¹æ€§ï¼Œåœ¨ä¸åŒçš„åº”ç”¨åœºæ™¯ä¸‹å¯ä»¥å±•ç°ä¸åŒçš„ä½œç”¨ ã€‚æ€» çš„æ¥è¯´ï¼Œæ¶ˆæ¯ä¸­é—´ä»¶çš„ä½œç”¨å¯ä»¥æ¦‚æ‹¬å¦‚ä¸‹ã€‚ è§£è€¦åœ¨é¡¹ç›®å¯åŠ¨ä¹‹åˆæ¥é¢„æµ‹å°†æ¥ä¼šç¢°åˆ°ä»€ä¹ˆéœ€æ±‚æ˜¯æå…¶å›°éš¾çš„ã€‚æ¶ˆæ¯ä¸­é—´ä»¶åœ¨å¤„ç†è¿‡ç¨‹ ä¸­é—´æ’å…¥äº†ä¸€ä¸ªéšå«çš„ã€åŸºäºæ•°æ®çš„æ¥å£å±‚ï¼Œä¸¤è¾¹çš„å¤„ç†è¿‡ç¨‹éƒ½è¦å®ç°è¿™ä¸€æ¥å£ï¼Œè¿™å…è®¸ä½ ç‹¬ ç«‹åœ°æ‰©å±•æˆ–ä¿®æ”¹ä¸¤è¾¹çš„å¤„ç†è¿‡ç¨‹ï¼Œåªè¦ç¡®ä¿å®ƒ ä»¬éµå®ˆåŒæ ·çš„æ¥å£çº¦æŸå³å¯ã€‚ å†—ä½™ã€ˆå­˜å‚¨)æœ‰äº›æƒ…å†µä¸‹ï¼Œå¤„ç†æ•°æ®çš„è¿‡ç¨‹ä¼šå¤±è´¥ã€‚æ¶ˆæ¯ä¸­é—´ä»¶å¯ä»¥æŠŠæ•°æ®è¿›è¡ŒæŒä¹…åŒ–ç›´ åˆ°å®ƒä»¬å·²ç»è¢«å®Œå…¨å¤„ç†ï¼Œé€šè¿‡è¿™ä¸€æ–¹å¼è§„é¿äº†æ•°æ®ä¸¢å¤±é£é™©ã€‚åœ¨æŠŠä¸€ä¸ªæ¶ˆæ¯ä»æ¶ˆæ¯ä¸­é—´ä»¶ä¸­åˆ é™¤ä¹‹å‰ï¼Œéœ€è¦ä½ çš„å¤„ç†ç³»ç»Ÿæ˜ç¡®åœ°æŒ‡å‡ºè¯¥æ¶ˆæ¯å·±ç»è¢«å¤„ç†å®Œæˆï¼Œä»è€Œç¡®ä¿ä½ çš„æ•°æ®è¢«å®‰å…¨åœ°ä¿ å­˜ç›´åˆ°ä½ ä½¿ç”¨å®Œæ¯•ã€‚ æ‰©å±•æ€§å› ä¸ºæ¶ˆæ¯ä¸­é—´ä»¶è§£æäº†åº”ç”¨çš„å¤„ç†è¿‡ç¨‹ï¼Œæ‰€ä»¥æé«˜æ¶ˆæ¯å…¥é˜Ÿå’Œå¤„ç†çš„æ•ˆç‡æ˜¯å¾ˆå®¹æ˜“çš„ï¼Œåªè¦å¦å¤–å¢åŠ å¤„ç†è¿‡ç¨‹å³å¯ï¼Œä¸éœ€è¦æ”¹å˜ä»£ç ï¼Œä¹Ÿä¸éœ€è¦è°ƒèŠ‚å‚æ•°ã€‚ å‰Šå³°åœ¨è®¿é—®é‡å‰§å¢çš„æƒ…å†µä¸‹ï¼Œåº”ç”¨ä»ç„¶éœ€è¦ç»§ç»­å‘æŒ¥ä½œç”¨ï¼Œä½†æ˜¯è¿™æ ·çš„çªå‘æµé‡å¹¶ä¸å¸¸è§ã€‚å¦‚æœä»¥èƒ½å¤„ç†è¿™ç±»å³°å€¼ä¸ºæ ‡å‡†è€ŒæŠ•å…¥èµ„æºï¼Œæ— ç–‘æ˜¯å·¨å¤§çš„æµªè´¹ã€‚ä½¿ç”¨æ¶ˆæ¯ä¸­é—´ä»¶èƒ½å¤Ÿä½¿å…³é”®ç»„ä»¶æ”¯æ’‘çªå‘è®¿é—®å‹åŠ›ï¼Œä¸ä¼šå› ä¸ºçªå‘çš„è¶…è´Ÿè·è¯·æ±‚è€Œå®Œå…¨å´©æƒ¯ã€‚ å¯æ¢å¤æ€§å½“ç³»ç»Ÿä¸€éƒ¨åˆ†ç»„ä»¶å¤±æ•ˆæ—¶ï¼Œä¸ä¼šå½±å“åˆ°æ•´ä¸ªç³»ç»Ÿã€‚æ¶ˆæ¯ä¸­é—´ä»¶é™ä½äº†è¿›ç¨‹é—´çš„ç¨¿åˆåº¦ï¼Œæ‰€ä»¥å³ä½¿ä¸€ä¸ªå¤„ç†æ¶ˆæ¯çš„è¿›ç¨‹æŒ‚æ‰ï¼ŒåŠ å…¥æ¶ˆæ¯ä¸­é—´ä»¶ä¸­çš„æ¶ˆæ¯ä»ç„¶å¯ä»¥åœ¨ç³»ç»Ÿæ¢å¤å è¿›è¡Œå¤„ç†ã€‚ é¡ºåºä¿è¯åœ¨å¤§å¤šæ•°ä½¿ç”¨åœºæ™¯ä¸‹ï¼Œæ•°æ®å¤„ç†çš„é¡ºåºå¾ˆé‡è¦ï¼Œå¤§éƒ¨åˆ†æ¶ˆæ¯ä¸­é—´ä»¶æ”¯æŒä¸€å®šç¨‹åº¦ä¸Šçš„é¡ºåºæ€§ã€‚ ç¼“å†²åœ¨ä»»ä½•é‡è¦çš„ç³»ç»Ÿä¸­ï¼Œéƒ½ä¼šå­˜åœ¨éœ€è¦ä¸åŒå¤„ç†æ—¶é—´çš„å…ƒç´ ã€‚æ¶ˆæ¯ä¸­é—´ä»¶é€šè¿‡ä¸€ä¸ªç¼“å†²å±‚æ¥å¸®åŠ©ä»»åŠ¡æœ€é«˜æ•ˆç‡åœ°æ‰§è¡Œï¼Œå†™å…¥æ¶ˆæ¯ä¸­é—´ä»¶çš„å¤„ç†ä¼šå°½å¯èƒ½å¿«é€Ÿã€‚è¯¥ç¼“å†²å±‚æœ‰åŠ©äºæ§åˆ¶ å’Œä¼˜åŒ–æ•°æ®æµç»è¿‡ç³»ç»Ÿçš„é€Ÿåº¦ã€‚ å¼‚æ­¥é€šä¿¡åœ¨å¾ˆå¤šæ—¶å€™åº”ç”¨ä¸æƒ³ä¹Ÿä¸éœ€è¦ç«‹å³å¤„ç†æ¶ˆæ¯ ã€‚æ¶ˆæ¯ä¸­é—´ä»¶æä¾›äº†å¼‚æ­¥å¤„ç†æœºåˆ¶ï¼Œå…è®¸åº”ç”¨æŠŠä¸€äº›æ¶ˆæ¯æ”¾å…¥æ¶ˆæ¯ä¸­é—´ä»¶ä¸­ï¼Œä½†å¹¶ä¸ç«‹å³å¤„ç†å®ƒï¼Œåœ¨ä¹‹åéœ€è¦çš„æ—¶å€™å†æ…¢æ…¢å¤„ç†ã€‚ RabbitMQå…¥é—¨RabbitMQä»‹ç»RabbitMQ æ˜¯é‡‡ç”¨ Erlang è¯­è¨€å®ç° AMQP (Advanced Message Queuing Protocolï¼Œé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®)çš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå®ƒæœ€åˆèµ·æºäºé‡‘èç³»ç»Ÿï¼Œç”¨äºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å­˜å‚¨è½¬å‘æ¶ˆæ¯ã€‚å¹¶ä¸”æ”¯æŒå¤šç§å®¢æˆ·ç«¯ å¦‚ï¼šPythonã€Rubyã€.NETã€Javaã€JMSã€Cã€PHPã€ActionScriptã€XMPPã€STOMPç­‰ï¼Œæ”¯æŒAJAXã€‚åœ¨æ˜“ç”¨æ€§ã€æ‰©å±•æ€§ã€é«˜å¯ç”¨æ€§ç­‰æ–¹é¢è¡¨ç°ä¸ä¿—ã€‚ RabbitMQä¸»è¦æ˜¯ä¸ºäº†å®ç°ç³»ç»Ÿä¹‹é—´çš„åŒå‘è§£è€¦è€Œå®ç°çš„ã€‚å½“ç”Ÿäº§è€…å¤§é‡äº§ç”Ÿæ•°æ®æ—¶ï¼Œæ¶ˆè´¹è€…æ— æ³•å¿«é€Ÿæ¶ˆè´¹ï¼Œé‚£ä¹ˆéœ€è¦ä¸€ä¸ªä¸­é—´å±‚ã€‚ä¿å­˜è¿™ä¸ªæ•°æ®ã€‚ AMQPï¼Œå³Advanced Message Queuing Protocolï¼Œé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼Œæ˜¯åº”ç”¨å±‚åè®®çš„ä¸€ä¸ªå¼€æ”¾æ ‡å‡†ï¼Œä¸ºé¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶è®¾è®¡ã€‚æ¶ˆæ¯ä¸­é—´ä»¶ä¸»è¦ç”¨äºç»„ä»¶ä¹‹é—´çš„è§£è€¦ï¼Œæ¶ˆæ¯çš„å‘é€è€…æ— éœ€çŸ¥é“æ¶ˆæ¯ä½¿ç”¨è€…çš„å­˜åœ¨ï¼Œåä¹‹äº¦ç„¶ã€‚AMQPçš„ä¸»è¦ç‰¹å¾æ˜¯é¢å‘æ¶ˆæ¯ã€é˜Ÿåˆ—ã€è·¯ç”±ï¼ˆåŒ…æ‹¬ç‚¹å¯¹ç‚¹å’Œå‘å¸ƒ/è®¢é˜…ï¼‰ã€å¯é æ€§ã€å®‰å…¨ã€‚ RabbitMQå®‰è£… ä½¿ç”¨dockerå®‰è£…(3-managementç‰ˆæœ¬è‡ªå¸¦ç®¡ç†åå°) 1$ docker pull rabbitmq:3-management å¯åŠ¨rabbitMQå¹¶ä¸”å¯åŠ¨ç®¡ç†åå° 123$ docker run -d -p 15672:15672 -p 5672:5672 -e RABBITMQ_DEFAULT_USER=admin -e RABBITMQ_DEFAULT_PASS=admin --name rabbitmq --hostname=rabbitmqhostone rabbitmq:3-management$ docker start rabbitmq æŸ¥çœ‹ç®¡ç†åå°åœ¨æµè§ˆå™¨æ‰“å¼€ http://localhost:15672/ è¾“å…¥ç”¨æˆ·å:admin å¯†ç :admin å¯è¿›å…¥ç®¡ç†åå° ç›¸å…³æ¦‚å¿µä»‹ç»ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€… Producer:ç”Ÿäº§è€…ï¼Œå°±æ˜¯æŠ•é€’æ¶ˆæ¯çš„ä¸€æ–¹ã€‚ç”Ÿäº§è€…åˆ›å»ºæ¶ˆæ¯ï¼Œç„¶åå‘å¸ƒåˆ° RabbitMQ ä¸­ã€‚æ¶ˆæ¯ä¸€èˆ¬å¯ä»¥åŒ…å«2ä¸ªéƒ¨åˆ†:æ¶ˆæ¯ä½“å’Œæ ‡ç­¾(Label)ã€‚æ¶ˆæ¯ä½“ä¹Ÿå¯ä»¥ç§°ä¹‹ä¸ºpayloadï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ¶ˆæ¯ä½“ä¸€èˆ¬æ˜¯ä¸€ä¸ªå¸¦æœ‰ä¸šåŠ¡é€»è¾‘ç»“æ„çš„æ•°æ®ï¼Œæ¯”å¦‚ä¸€ä¸ªJSONå­—ç¬¦ä¸²ã€‚å½“ç„¶å¯ä»¥è¿›ä¸€æ­¥å¯¹è¿™ä¸ªæ¶ˆæ¯ä½“è¿›è¡Œåºåˆ—åŒ–æ“ä½œã€‚æ¶ˆæ¯çš„æ ‡ç­¾ç”¨æ¥è¡¨è¿°è¿™æ¡æ¶ˆæ¯ï¼Œæ¯”å¦‚ä¸€ä¸ªäº¤æ¢å™¨çš„åç§°å’Œä¸€ä¸ªè·¯ç”±é”®ã€‚ç”Ÿäº§è€…æŠŠæ¶ˆæ¯äº¤ç”±RabbitMQï¼ŒRabbitMQ ä¹‹åä¼šæ ¹æ®æ ‡ç­¾æŠŠæ¶ˆæ¯å‘é€ç»™æ„Ÿå…´è¶£çš„æ¶ˆè´¹è€…(Consumer)ã€‚ Consumer:æ¶ˆè´¹è€…ï¼Œå°±æ˜¯æ¥æ”¶æ¶ˆæ¯çš„ä¸€æ–¹ã€‚æ¶ˆè´¹è€…è¿æ¥åˆ°RabbitMQæœåŠ¡å™¨ï¼Œå¹¶è®¢é˜…åˆ°é˜Ÿåˆ—ä¸Šã€‚å½“æ¶ˆè´¹è€…æ¶ˆè´¹ä¸€æ¡æ¶ˆæ¯æ—¶ï¼Œåªæ˜¯æ¶ˆè´¹æ¶ˆæ¯çš„æ¶ˆæ¯ä½“(payload).åœ¨æ¶ˆæ¯è·¯ç”±çš„è¿‡ç¨‹ä¸­ï¼Œæ¶ˆæ¯çš„æ ‡ç­¾ä¼šä¸¢å¼ƒï¼Œå­˜å…¥åˆ°é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯åªæœ‰æ¶ˆæ¯ä½“ï¼Œæ¶ˆè´¹è€…ä¹Ÿåªä¼šæ¶ˆè´¹åˆ°æ¶ˆæ¯ä½“ï¼Œä¹Ÿå°±ä¸çŸ¥é“æ¶ˆæ¯çš„ç”Ÿäº§è€…æ˜¯è°ï¼Œå½“ç„¶æ¶ˆè´¹è€…ä¹Ÿä¸éœ€è¦çŸ¥é“ã€‚ Broker:æ¶ˆæ¯ä¸­é—´ä»¶çš„æœåŠ¡èŠ‚ç‚¹ã€‚å¯¹äºRabbitMQæ¥è¯´ï¼Œä¸€ä¸ªRabbitMQBrokerå¯ä»¥ç®€å•åœ°çœ‹ä½œä¸€ä¸ªRabbitMQæœåŠ¡èŠ‚ç‚¹ï¼Œæˆ–è€…RabbitMQæœåŠ¡å®ä¾‹ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ä¹Ÿå¯ä»¥å°†ä¸€ä¸ªRabbitMQ Brokerçœ‹ä½œä¸€å°RabbitMQæœåŠ¡å™¨ã€‚ RabbitMQè¿è½¬æµç¨‹ äº¤æ¢å™¨Exchangeï¼Œè·¯ç”±RoutingKeyï¼Œç»‘å®šBinding Exchange:äº¤æ¢å™¨MQä¸­æˆ‘ä»¬æš‚æ—¶å¯ä»¥ç†è§£æˆç”Ÿäº§è€…å°†æ¶ˆæ¯æŠ•é€’åˆ°é˜Ÿåˆ—ä¸­ï¼Œä½†æ˜¯å®é™…ä¸Šè¿™ä¸ªåœ¨RabbitMQä¸­ä¸ä¼šå‘ç”Ÿã€‚çœŸå®æƒ…å†µæ˜¯ï¼Œç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ°Exchange(äº¤æ¢å™¨)ï¼Œç”±äº¤æ¢å™¨å°†æ¶ˆæ¯è·¯ç”±åˆ°ä¸€ä¸ªæˆ–è€…å¤šä¸ªé˜Ÿåˆ—ä¸­ã€‚å¦‚æœè·¯ç”±ä¸åˆ°ï¼Œæˆ–è®¸ä¼šè¿”å›ç»™ç”Ÿäº§è€…ï¼Œæˆ–è®¸ç›´æ¥ä¸¢å¼ƒã€‚RabbitMQä¸­çš„äº¤æ¢å™¨æœ‰å››ç§ç±»å‹ï¼Œä¸‹é¢ä¼šä¸€ä¸€ä»‹ç»ï¼Œå¹¶ä¸”ä¼šä½¿ç”¨ä»£ç è¯¦ç»†è¯´æ˜ã€‚ RoutingKey:è·¯ç”±é”®ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘ç»™äº¤æ¢å™¨çš„æ—¶å€™ï¼Œä¸€èˆ¬ä¼šæŒ‡å®šä¸€ä¸ªRoutingKeyï¼Œç”¨æ¥æŒ‡å®šè¿™ä¸ªæ¶ˆæ¯çš„è·¯ç”±è§„åˆ™ï¼Œè€Œè¿™ä¸ªRoutingKeyéœ€è¦ä¸äº¤æ¢å™¨ç±»å‹å’Œç»‘å®šé”®(BindingKey)è”åˆä½¿ç”¨æ‰èƒ½æœ€ç»ˆç”Ÿæ•ˆã€‚åœ¨äº¤æ¢å™¨ç±»å‹å’Œç»‘å®šé”®(BindingKey)å›ºå®šçš„æƒ…å†µä¸‹ï¼Œç”Ÿäº§è€…å¯ä»¥åœ¨å‘é€æ¶ˆæ¯ç»™äº¤æ¢å™¨æ—¶ï¼Œé€šè¿‡æŒ‡å®šRoutingKeyæ¥å†³å®šæ¶ˆæ¯æµå‘å“ªé‡Œã€‚ Binding:ç»‘å®šRabbitMQä¸­é€šè¿‡ç»‘å®šå°†äº¤æ¢å™¨ä¸é˜Ÿåˆ—å…³è”èµ·æ¥ï¼Œåœ¨ç»‘å®šçš„æ—¶å€™ ä¸€èˆ¬ä¼šæŒ‡å®šä¸€ä¸ªç»‘å®šé”®(BindingKey)ï¼Œè¿™æ ·RabbitMQå°±çŸ¥é“å¦‚ä½•æ­£ç¡®åœ°å°†æ¶ˆæ¯è·¯ç”±åˆ°é˜Ÿåˆ—äº†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º: äº¤æ¢å™¨ç±»å‹RabbitMQ å¸¸ç”¨çš„äº¤æ¢å™¨ç±»å‹æœ‰fanoutã€directã€topicã€headersè¿™å››ç§ã€‚AMQPåè®®é‡Œè¿˜æåˆ°å¦å¤–ä¸¤ç§ç±»å‹:Systemå’Œè‡ªå®šä¹‰ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†ä»‹ç»äº†ã€‚ fanoutå°±æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„å¹¿æ’­æ¨¡å¼æˆ–è€…è®¢é˜…æ¨¡å¼ï¼Œå®ƒä¼šæŠŠæ‰€æœ‰å‘é€åˆ°è¯¥ExChangeçš„æ¶ˆæ¯å…¨éƒ¨è·¯ç”±åˆ°æ‰€æœ‰ä¸è¯¥äº¤æ¢å™¨ç»‘å®šçš„é˜Ÿåˆ—ä¸­ã€‚å¦‚ä¸‹å›¾ï¼š direct(é»˜è®¤çš„äº¤æ¢å™¨ç±»å‹)directç±»å‹çš„äº¤æ¢å™¨è·¯ç”±è§„åˆ™ä¹Ÿå¾ˆç®€å•ï¼Œå®ƒä¼šæŠŠæ¶ˆæ¯è·¯ç”±åˆ°é‚£äº› BindingKeyå’Œ RoutingKey å®Œå…¨åŒ¹é…çš„é˜Ÿåˆ—ä¸­ã€‚å¦‚ä¸‹å›¾ï¼š topicä¸Šé¢è®²åˆ°directç±»å‹çš„äº¤æ¢å™¨è·¯ç”±è§„åˆ™æ˜¯å®Œå…¨åŒ¹é…BindingKeyå’ŒRoutingKeyï¼Œä½†æ˜¯è¿™ç§ä¸¥æ ¼çš„åŒ¹é…æ–¹å¼åœ¨å¾ˆå¤šæƒ…å†µä¸‹ä¸èƒ½æ»¡è¶³å®é™…ä¸šåŠ¡çš„éœ€æ±‚ã€‚topicç±»å‹çš„äº¤æ¢å™¨åœ¨åŒ¹é…è§„åˆ™ä¸Šè¿›è¡Œäº†æ‰©å±•ï¼Œå®ƒä¸directç±»å‹çš„äº¤æ¢å™¨ç›¸ä¼¼ï¼Œä¹Ÿæ˜¯å°†æ¶ˆæ¯è·¯ç”±åˆ°BindingKeyå’ŒRoutingKeyç›¸åŒ¹é…çš„é˜Ÿåˆ—ä¸­ï¼Œä½†è¿™é‡Œçš„åŒ¹é…è§„åˆ™æœ‰äº›ä¸åŒï¼Œå®ƒçº¦å®š: RoutingKeyä¸ºä¸€ä¸ªç‚¹å·â€.â€åˆ†éš”çš„å­—ç¬¦ä¸²(è¢«ç‚¹å·â€.â€åˆ†éš”å¼€çš„æ¯ä¸€æ®µç‹¬ç«‹çš„å­—ç¬¦ä¸²ç§°ä¸ºä¸€ä¸ªå•è¯)ï¼Œå¦‚â€com.rabbitmq.clientâ€ï¼Œâ€java.util.concurrentâ€,â€com.hidden.clientâ€ç­‰ BindingKeyä¹Ÿæ˜¯ç‚¹å·â€.â€åˆ†éš” BindingKeyä¸­å¯ä»¥å­˜åœ¨ä¸¤ç§ç‰¹æ®Šå­—ç¬¦ä¸²â€æ˜Ÿå·â€å’Œâ€#â€ï¼Œç”¨äºåšæ¨¡ç³ŠåŒ¹é…ï¼Œå…¶ä¸­â€æ˜Ÿå·â€ç”¨äºåŒ¹é…ä¸€ä¸ªå•è¯ï¼Œâ€#â€ç”¨äºåŒ¹é…å¤šè§„æ ¼å•è¯(å¯ä»¥æ˜¯é›¶ä¸ª)ã€‚å¦‚ä¸‹å›¾ï¼šæ€è€ƒ:1.è·¯ç”±å»º â€œcom.rabbitmq.clientâ€ä¼šè·¯ç”±åˆ°å“ªä¸€ä¸ªé˜Ÿåˆ—ï¼Ÿ2.è·¯ç”±å»º â€œcom.hidden.clientâ€ä¼šè·¯ç”±åˆ°å“ªä¸€ä¸ªé˜Ÿåˆ—ï¼Ÿ3.è·¯ç”±å»º â€œcom.hidden.demoâ€ä¼šè·¯ç”±åˆ°å“ªä¸€ä¸ªé˜Ÿåˆ—ï¼Ÿ4.è·¯ç”±å»º â€œjava.util.concurrentâ€ä¼šè·¯ç”±åˆ°å“ªä¸€ä¸ªé˜Ÿåˆ—ï¼Ÿ5.è·¯ç”±å»º â€œjava.rabbitmq.demoâ€ä¼šè·¯ç”±åˆ°å“ªä¸€ä¸ªé˜Ÿåˆ—ï¼Ÿ headers(ä¸å¸¸ç”¨)headersç±»å‹çš„äº¤æ¢å™¨ä¸ä¾èµ–äºè·¯ç”±é”®çš„åŒ¹é…è§„åˆ™æ¥è·¯ç”±æ¶ˆæ¯ï¼Œè€Œæ˜¯æ ¹æ®å‘é€çš„æ¶ˆæ¯å†…å®¹ä¸­çš„headerså±æ€§è¿›è¡ŒåŒ¹é…ã€‚åœ¨ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢å™¨æ—¶åˆ¶å®šä¸€ç»„é”®å€¼å¯¹ï¼Œå½“å‘é€æ¶ˆæ¯åˆ°äº¤æ¢å™¨æ—¶ï¼ŒRabbitMQä¼šè·å–åˆ°è¯¥æ¶ˆæ¯çš„headers(ä¹Ÿæ˜¯ä¸€ä¸ªé”®å€¼å¯¹çš„å½¢å¼)ï¼Œå¯¹æ¯”å…¶ä¸­çš„é”®å€¼å¯¹æ˜¯å¦å®Œå…¨åŒ¹é…é˜Ÿåˆ—å’Œäº¤æ¢å™¨ç»‘å®šæ—¶æŒ‡å®šçš„é”®å€¼å¯¹ï¼Œå¦‚æœå®Œå…¨åŒ¹é…åˆ™æ¶ˆæ¯ä¼šè·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ï¼Œå¦åˆ™ä¸ä¼šè·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚headersç±»å‹çš„äº¤æ¢å™¨æ€§èƒ½ä¼šå¾ˆå·®ï¼Œè€Œä¸”ä¹Ÿä¸å®ç”¨ï¼ŒåŸºæœ¬ä¸Šä¸ä¼šçœ‹åˆ°å®ƒçš„å­˜åœ¨ã€‚ äº¤æ¢å™¨ç±»å‹è¯¦è§£###æ–°å»ºrabbit-demoå·¥ç¨‹ï¼Œåœ¨å…¶ä¸­æ–°å»ºä¸¤ä¸ªmudle ä¸€ä¸ªä¸ºrabbit-consumer å¦ä¸€ä¸ªä¸ºrabbit-producerpom.xml12345678910&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt;&lt;/dependency&gt; rabbit-producer/application.properties1234567server.port=1180# ç«¯å£ 1181 æ¶ˆè´¹è€… 1180 ç”Ÿäº§è€…spring.rabbitmq.host=127.0.0.1spring.rabbitmq.username=adminspring.rabbitmq.password=adminspring.rabbitmq.port=5672 rabbit-producer/application.properties1234567server.port=1181# ç«¯å£ 1181 æ¶ˆè´¹è€… 1180 ç”Ÿäº§è€…spring.rabbitmq.host=127.0.0.1spring.rabbitmq.username=adminspring.rabbitmq.password=adminspring.rabbitmq.port=5672 é¡¹ç›®åˆ›å»ºå®Œæˆ å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—å„ä¸ªå‚æ•°çš„æ„ä¹‰name: é˜Ÿåˆ—çš„åç§° å­—ç¬¦ä¸²durable: æ˜¯å¦æŒä¹…åŒ–, é˜Ÿåˆ—çš„å£°æ˜é»˜è®¤æ˜¯å­˜æ”¾åˆ°å†…å­˜ä¸­çš„ï¼Œå¦‚æœrabbitmqé‡å¯ä¼šä¸¢å¤±ï¼Œå¦‚æœæƒ³é‡å¯ä¹‹åè¿˜å­˜åœ¨å°±è¦ä½¿é˜Ÿåˆ—æŒä¹…åŒ–ï¼Œä¿å­˜åˆ°Erlangè‡ªå¸¦çš„Mnesiaæ•°æ®åº“ä¸­ï¼Œå½“rabbitmqé‡å¯ä¹‹åä¼šè¯»å–è¯¥æ•°æ®åº“exclusive: æ˜¯å¦æ’å¤–çš„ï¼Œæœ‰ä¸¤ä¸ªä½œç”¨ï¼Œä¸€ï¼šå½“è¿æ¥å…³é—­æ—¶connection.close()è¯¥é˜Ÿåˆ—æ˜¯å¦ä¼šè‡ªåŠ¨åˆ é™¤ï¼›äºŒï¼šè¯¥é˜Ÿåˆ—æ˜¯å¦æ˜¯ç§æœ‰çš„privateï¼Œå¦‚æœä¸æ˜¯æ’å¤–çš„ï¼Œå¯ä»¥ä½¿ç”¨ä¸¤ä¸ªæ¶ˆè´¹è€…éƒ½è®¿é—®åŒä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œå¦‚æœæ˜¯æ’å¤–çš„ï¼Œä¼šå¯¹å½“å‰é˜Ÿåˆ—åŠ é”ï¼Œå…¶ä»–é€šé“channelæ˜¯ä¸èƒ½è®¿é—®çš„ï¼Œå¦‚æœå¼ºåˆ¶è®¿é—®ä¼šæŠ¥å¼‚å¸¸ï¼Œä¸€èˆ¬ç­‰äºtrueçš„è¯ç”¨äºä¸€ä¸ªé˜Ÿåˆ—åªèƒ½æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…æ¥æ¶ˆè´¹çš„åœºæ™¯ã€‚autoDelete: æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œå½“æœ€åä¸€ä¸ªæ¶ˆè´¹è€…æ–­å¼€è¿æ¥ä¹‹åé˜Ÿåˆ—æ˜¯å¦è‡ªåŠ¨è¢«åˆ é™¤ï¼Œå¯ä»¥é€šè¿‡RabbitMQ Managementï¼ŒæŸ¥çœ‹æŸä¸ªé˜Ÿåˆ—çš„æ¶ˆè´¹è€…æ•°é‡ï¼Œå½“consumers = 0æ—¶é˜Ÿåˆ—å°±ä¼šè‡ªåŠ¨åˆ é™¤arguments: é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä»€ä¹ˆæ—¶å€™ä¼šè‡ªåŠ¨è¢«åˆ é™¤ï¼Ÿ æ˜¯ä¸€ä¸ªMap&lt;String, Object&gt;ï¼Œä»–æœ‰å¦‚ä¸‹å‚æ•° â€œx-message-ttlâ€: 1000 è®¾ç½®é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰æ¶ˆæ¯çš„ç”Ÿå­˜å‘¨æœŸ â€œx-expiresâ€: 1000 å½“é˜Ÿåˆ—åœ¨æŒ‡å®šçš„æ—¶é—´æ²¡æœ‰è¢«è®¿é—®å°±ä¼šè¢«åˆ é™¤ â€œx-max-lengthâ€: 10 é™å®šé˜Ÿåˆ—çš„æ¶ˆæ¯çš„æœ€å¤§å€¼é•¿åº¦ï¼Œè¶…è¿‡æŒ‡å®šé•¿åº¦å°†ä¼šæŠŠæœ€æ—©çš„å‡ æ¡åˆ é™¤æ‰ â€œx-max-length-bytesâ€: é™å®šé˜Ÿåˆ—æœ€å¤§å ç”¨çš„ç©ºé—´å¤§å°ï¼Œ ä¸€èˆ¬å—é™äºå†…å­˜ã€ç£ç›˜çš„å¤§å° â€œx-dead-letter-exchangeâ€: â€œâ€ å½“é˜Ÿåˆ—æ¶ˆæ¯é•¿åº¦å¤§äºæœ€å¤§é•¿åº¦ã€æˆ–è€…è¿‡æœŸçš„ç­‰ï¼Œå°†ä»é˜Ÿåˆ—ä¸­åˆ é™¤çš„æ¶ˆæ¯æ¨é€åˆ°æŒ‡å®šçš„äº¤æ¢æœºä¸­å»è€Œä¸æ˜¯ä¸¢å¼ƒæ‰ â€œx-dead-letter-routing-keyâ€: â€œâ€ å°†åˆ é™¤çš„æ¶ˆæ¯æ¨é€åˆ°æŒ‡å®šäº¤æ¢æœºçš„æŒ‡å®šè·¯ç”±é”®çš„é˜Ÿåˆ—ä¸­å» â€œx-max-priorityâ€: ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œå£°æ˜é˜Ÿåˆ—æ—¶å…ˆå®šä¹‰æœ€å¤§ä¼˜å…ˆçº§å€¼(å®šä¹‰æœ€å¤§å€¼ä¸€èˆ¬ä¸è¦å¤ªå¤§)ï¼Œåœ¨å‘å¸ƒæ¶ˆæ¯çš„æ—¶å€™æŒ‡å®šè¯¥æ¶ˆæ¯çš„ä¼˜å…ˆçº§ï¼Œ ä¼˜å…ˆçº§æ›´é«˜ï¼ˆæ•°å€¼æ›´å¤§çš„ï¼‰çš„æ¶ˆæ¯å…ˆè¢«æ¶ˆè´¹ â€œx-queue-modeâ€: â€œlazyâ€ å…ˆå°†æ¶ˆæ¯ä¿å­˜åˆ°ç£ç›˜ä¸Šï¼Œä¸æ”¾åœ¨å†…å­˜ä¸­ï¼Œå½“æ¶ˆè´¹è€…å¼€å§‹æ¶ˆè´¹çš„æ—¶å€™æ‰åŠ è½½åˆ°å†…å­˜ä¸­ â€œx-queue-master-locatorâ€ fanoutä»£ç å®ç°åœ¨æ¶ˆè´¹è€…é¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ªé…ç½®ç±»12345678910111213141516171819202122232425262728293031323334353637383940414243package com.jiafly.rabbit.consumer.fanout;import org.springframework.amqp.core.Binding;import org.springframework.amqp.core.BindingBuilder;import org.springframework.amqp.core.FanoutExchange;import org.springframework.amqp.core.Queue;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;/** * @author liuyi * @date 2018/12/1 4:35 PM */@Configurationpublic class FanoutConfig &#123; // å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—ï¼Œåé¢æœ‰å¾ˆå¤šå±æ€§ @Bean public Queue fanoutQueue1()&#123; return new Queue("fanout.queue1"); &#125; @Bean public Queue fanoutQueue2()&#123; return new Queue("fanout.queue2"); &#125; @Bean public FanoutExchange fanoutExchange()&#123; return new FanoutExchange("fanout_exchange"); &#125; @Bean public Binding fanoutBinding1()&#123; return BindingBuilder.bind(fanoutQueue1()).to(fanoutExchange()); &#125; @Bean public Binding fanoutBinding2()&#123; return BindingBuilder.bind(fanoutQueue2()).to(fanoutExchange()); &#125;&#125; åœ¨æ¶ˆè´¹è€…é¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ªæ¶ˆæ¯ç›‘å¬ç±»1234567891011121314151617181920212223242526272829package com.jiafly.rabbit.consumer.fanout;import lombok.extern.slf4j.Slf4j;import org.springframework.amqp.rabbit.annotation.RabbitHandler;import org.springframework.amqp.rabbit.annotation.RabbitListener;import org.springframework.stereotype.Component;/** * @author liuyi * @date 2018/12/1 4:40 PM */@Component@Slf4jpublic class FanoutConsumer &#123; @RabbitListener(queues = "fanout.queue1") @RabbitHandler public void fanoutConsumer1(String msg)&#123; log.info("1fanoutConsumer æ¥æ”¶æ¶ˆæ¯msg: &#123;&#125;", msg); &#125; @RabbitListener(queues = "fanout.queue2") @RabbitHandler public void fanoutConsumer2(String msg)&#123; log.info("2fanoutConsumer æ¥æ”¶æ¶ˆæ¯msg: &#123;&#125;", msg); &#125;&#125; åœ¨ç”Ÿäº§è€…é¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ªæ¶ˆæ¯å‘é€controller12345678910111213141516171819202122232425262728293031323334353637package com.jiafly.rabbit.producer;import lombok.extern.slf4j.Slf4j;import org.springframework.amqp.core.AmqpTemplate;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.web.bind.annotation.PathVariable;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;/** * @author liuyi * @date 2018/11/28 11:50 AM * ç”Ÿäº§è€… */@RestController@RequestMapping()@Slf4jpublic class FanoutProducer &#123; @Autowired private AmqpTemplate template; /** * fanoutç±»å‹ * @param msg æ¶ˆæ¯å†…å®¹ * @return æ¶ˆæ¯å†…å®¹ * è™½ç„¶fanoutç±»å‹ä¸‹ä¸éœ€è¦routingKey ä½†æ˜¯åœ¨è°ƒç”¨convertAndSendæ–¹æ³•æ—¶è¿˜æ˜¯éœ€è¦é…ç½®routingKey * åªæ˜¯routingKeyå¯ä»¥ä»»æ„æŒ‡å®š */ @RequestMapping("/fanout/&#123;msg&#125;") public String fanoutProducer(@PathVariable("msg") String msg)&#123; log.info("fanoutç”Ÿäº§æ¶ˆæ¯ msg:&#123;&#125;", msg); // ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯äº¤æ¢å™¨åç§° ç¬¬äºŒä¸ªå‚æ•°æ˜¯routingKeyåç§°ï¼Œfanoutæ¨¡å¼å†™ä»»ä½•keyéƒ½ä¼šè¢«æ— è§† ç¬¬ä¸‰ä¸ªæ˜¯è¦å‘é€çš„æ¶ˆæ¯ template.convertAndSend("fanout_exchange","", msg); return msg; &#125;&#125; æµ‹è¯•åˆ†åˆ«å¯åŠ¨ä¸¤ä¸ªé¡¹ç›®ï¼Œåœ¨æµè§ˆå™¨çš„è·¯å¾„ä¸Šè¾“å…¥ http://localhost:1180/fanout/æµ‹è¯•æ¶ˆæ¯ ï¼Œå°±å¯åœ¨æ¶ˆè´¹è€…é¡¹ç›®æ§åˆ¶å°ä¸­çœ‹åˆ°ç»‘å®šè¿™ä¸ªfanoutæ¨¡å¼äº¤æ¢å™¨çš„é˜Ÿåˆ—æ¥æ”¶åˆ°çš„æ¶ˆæ¯åœ¨æ§åˆ¶å°æ‰“å°å‡ºæ¥äº†ã€‚ directä»£ç å®ç°åœ¨æ¶ˆè´¹è€…é¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ªé…ç½®ç±»123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172package com.jiafly.rabbit.consumer.direct;import org.springframework.amqp.core.Binding;import org.springframework.amqp.core.BindingBuilder;import org.springframework.amqp.core.DirectExchange;import org.springframework.amqp.core.Queue;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import java.util.HashMap;import java.util.Map;/** * @author liuyi * @date 2018/11/29 1:40 AM */@Configurationpublic class DirectConfig &#123; /** * å®šä¹‰ä¸¤ä¸ªé˜Ÿåˆ— * @return */ @Bean public Queue directQueue1() &#123; return new Queue("direct.queue1",true); &#125; @Bean public Queue directQueue2() &#123; return new Queue("direct.queue2", true); &#125; @Bean public Queue directQueue3() &#123; Map&lt;String, Object&gt; map = new HashMap&lt;&gt;(16); return new Queue("direct.queue3",true,true, true, map); &#125; /** * å®šä¹‰ exchange * @return */ @Bean public DirectExchange directExchange() &#123; return new DirectExchange("direct_exchange",true,true); &#125; /** * é˜Ÿåˆ—1 ç»‘å®š exchange å¹¶ä¸”è®¾ç½®routingKeyä¸ºdirect.1 * @return */ @Bean public Binding directBinding1()&#123; return BindingBuilder.bind(directQueue1()).to(directExchange()).with("direct.routing.key1"); &#125; /** * é˜Ÿåˆ—2 ç»‘å®š exchange å¹¶ä¸”è®¾ç½®routingKeyä¸ºdirect.2 * @return */ @Bean public Binding directBinding2()&#123; return BindingBuilder.bind(directQueue2()).to(directExchange()).with("direct.routing.key2"); &#125; @Bean public Binding directBinding3()&#123; return BindingBuilder.bind(directQueue3()).to(directExchange()).with("direct.routing.key1"); &#125;&#125; åœ¨æ¶ˆè´¹è€…é¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ªæ¶ˆæ¯ç›‘å¬ç±»1å’Œfanoutç›¸åŒï¼Œåªæ˜¯ç›‘å¬çš„é˜Ÿåˆ—ä¸åŒè€Œå·² åœ¨ç”Ÿäº§è€…é¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ªæ¶ˆæ¯å‘é€controller12345678910111213141516171819202122232425262728293031323334353637383940414243package com.jiafly.rabbit.producer;import lombok.extern.slf4j.Slf4j;import org.springframework.amqp.core.AmqpTemplate;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.web.bind.annotation.PathVariable;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;/** * @author liuyi * @date 2018/11/28 11:50 AM * ç”Ÿäº§è€… */@RestController@RequestMapping()@Slf4jpublic class DirectProducer &#123; @Autowired private AmqpTemplate template; /** * directç±»å‹ * @param msg æ¶ˆæ¯å†…å®¹ * @return æ¶ˆæ¯å†…å®¹ */ @RequestMapping("/direct/queue1/&#123;msg&#125;") public String directProducerOne(@PathVariable("msg") String msg) &#123; log.info("ç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯:" + msg); // ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯äº¤æ¢å™¨åç§° ç¬¬äºŒä¸ªå‚æ•°æ˜¯routingKeyåç§° ç¬¬ä¸‰ä¸ªæ˜¯è¦å‘é€çš„æ¶ˆæ¯ template.convertAndSend("direct_exchange", "direct.routing.key1", msg); return msg; &#125; @RequestMapping("/direct/queue2/&#123;msg&#125;") public String directProducerTwo(@PathVariable("msg") String msg) &#123; log.info("ç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯:" + msg); // ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯äº¤æ¢å™¨åç§° ç¬¬äºŒä¸ªå‚æ•°æ˜¯routingKeyåç§° ç¬¬ä¸‰ä¸ªæ˜¯è¦å‘é€çš„æ¶ˆæ¯ template.convertAndSend("mq-direct_exchange", "direct.routing.key2", msg); return msg; &#125;&#125; æµ‹è¯•åˆ†åˆ«å¯åŠ¨ä¸¤ä¸ªé¡¹ç›®ï¼Œåœ¨æµè§ˆå™¨çš„è·¯å¾„ä¸Šè¾“å…¥ http://localhost:1180/direct/queue1/æµ‹è¯•æ¶ˆæ¯1 ï¼Œå°±å¯åœ¨æ¶ˆè´¹è€…é¡¹ç›®ä¸­çœ‹åˆ°æ‰“å°çš„ä¿¡æ¯ã€‚å¦‚æœéœ€è¦ä¸¤ä¸ªé˜Ÿåˆ—æ¥å—ç›¸åŒçš„ä¿¡æ¯ï¼Œåªéœ€è¦å°†ä¸¤ä¸ªé˜Ÿåˆ—ç»‘å®šçš„routingKeyè®¾ç½®ä¸ºä¸€æ ·å³å¯ topicä»£ç å®ç°åœ¨æ¶ˆè´¹è€…é¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ªé…ç½®ç±»12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152package com.jiafly.rabbit.consumer.topic;import org.springframework.amqp.core.Binding;import org.springframework.amqp.core.BindingBuilder;import org.springframework.amqp.core.Queue;import org.springframework.amqp.core.TopicExchange;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;/** * @author liuyi * @date 2018/11/29 8:42 AM */@Configurationpublic class TopicConfig &#123; /** * åˆ›å»ºé˜Ÿåˆ— * * @return */ @Bean public Queue topicQueue1() &#123; return new Queue("topic.queue1", true); &#125; @Bean public Queue topicQueue2() &#123; return new Queue("topic.queue2", true); &#125; /** * åˆ›å»ºäº¤æ¢å™¨ */ @Bean public TopicExchange topicExchange() &#123; return new TopicExchange("topic_exchange"); &#125; /** * ç»‘å®š */ @Bean public Binding topicBinding1() &#123; return BindingBuilder.bind(topicQueue1()).to(topicExchange()).with("*.jiafly.*"); &#125; @Bean public Binding topicBinding2() &#123; return BindingBuilder.bind(topicQueue2()).to(topicExchange()).with("com.jiafly.*"); &#125;&#125; åœ¨æ¶ˆè´¹è€…é¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ªæ¶ˆæ¯ç›‘å¬ç±»1å’Œfanoutç›¸åŒï¼Œåªæ˜¯ç›‘å¬çš„é˜Ÿåˆ—ä¸åŒè€Œå·² åœ¨ç”Ÿäº§è€…é¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ªæ¶ˆæ¯å‘é€controller12345678910111213141516171819202122232425262728293031323334package com.jiafly.rabbit.producer;import lombok.extern.slf4j.Slf4j;import org.springframework.amqp.core.AmqpTemplate;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.web.bind.annotation.PathVariable;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;/** * @author liuyi * @date 2018/11/28 11:50 AM * ç”Ÿäº§è€… */@RestController@RequestMapping()@Slf4jpublic class TopicProducer &#123; @Autowired private AmqpTemplate template; /** * topicç±»å‹ * @param msg æ¶ˆæ¯å†…å®¹ * @return æ¶ˆæ¯å†…å®¹ */ @RequestMapping("/topic/&#123;msg&#125;") public String topicProducerOne(@PathVariable("msg") String msg) &#123; log.info("topic:ç”Ÿäº§æ¶ˆæ¯:" + msg); template.convertAndSend("topic_exchange", "com.jiafly.test", msg); return msg; &#125;&#125; æµ‹è¯•åˆ†åˆ«å¯åŠ¨ä¸¤ä¸ªé¡¹ç›®ï¼Œåœ¨æµè§ˆå™¨çš„è·¯å¾„ä¸Šè¾“å…¥ http://localhost:1180/topic/æµ‹è¯•æ¶ˆæ¯ ï¼Œå°±å¯åœ¨æ¶ˆè´¹è€…é¡¹ç›®ä¸­çœ‹åˆ°æ‰“å°çš„ä¿¡æ¯ã€‚å¦‚æœéœ€è¦ä¸¤ä¸ªé˜Ÿåˆ—æ¥å—ç›¸åŒçš„ä¿¡æ¯ï¼Œåªéœ€è¦å°†ä¸¤ä¸ªé˜Ÿåˆ—ç»‘å®šçš„routingKeyä½¿ç”¨*æˆ–è€…#è¡¨ç¤º å»¶æ—¶é˜Ÿåˆ—å»¶æ—¶é˜Ÿåˆ—èƒ½åšä»€ä¹ˆ è®¢å•ä¸šåŠ¡ï¼šåœ¨ç”µå•†/ç‚¹é¤ä¸­ï¼Œéƒ½æœ‰ä¸‹å•å 30 åˆ†é’Ÿå†…æ²¡æœ‰ä»˜æ¬¾ï¼Œå°±è‡ªåŠ¨å–æ¶ˆè®¢å•ã€‚ çŸ­ä¿¡é€šçŸ¥ï¼šä¸‹å•æˆåŠŸå 60s ä¹‹åç»™ç”¨æˆ·å‘é€çŸ­ä¿¡é€šçŸ¥ã€‚ å¤±è´¥é‡è¯•ï¼šä¸šåŠ¡æ“ä½œå¤±è´¥åï¼Œé—´éš”ä¸€å®šçš„æ—¶é—´è¿›è¡Œå¤±è´¥é‡è¯• è¿™ç±»ä¸šåŠ¡çš„ç‰¹ç‚¹å°±æ˜¯ï¼šéå®æ—¶çš„ï¼Œéœ€è¦å»¶è¿Ÿå¤„ç†ï¼Œéœ€è¦è¿›è¡Œå¤±è´¥é‡è¯•ã€‚ä¸€ç§æ¯”è¾ƒç¬¨çš„æ–¹å¼æ˜¯é‡‡ç”¨å®šæ—¶ä»»åŠ¡ï¼Œè½®è®­æ•°æ®åº“ï¼Œæ–¹æ³•ç®€å•å¥½ç”¨ï¼Œä½†æ€§èƒ½åº•ä¸‹ï¼Œåœ¨é«˜å¹¶å‘æƒ…å†µä¸‹å®¹æ˜“å¼„æ­»æ•°æ®åº“ï¼Œé—´éš”æ—¶é—´ä¸å¥½è®¾ç½®ï¼Œæ—¶é—´è¿‡å¤§ï¼Œå½±å“ç²¾åº¦ï¼Œè¿‡å°å½±å“æ€§èƒ½ï¼Œè€Œä¸”åšä¸åˆ°æŒ‰è¶…æ—¶çš„æ—¶é—´é¡ºåºå¤„ç†ã€‚å¦ä¸€ç§å°±æ˜¯ç”¨Javaä¸­çš„DelayQueue ä½äºjava.util.concurrentåŒ…ä¸‹ï¼Œæœ¬è´¨æ˜¯ç”±PriorityQueueå’ŒBlockingQueueå®ç°çš„é˜»å¡ä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚ï¼Œè¿™ç©æ„æœ€å¤§çš„é—®é¢˜å°±æ˜¯ä¸æ”¯æŒåˆ†å¸ƒå¼ä¸æŒä¹…åŒ–ã€‚ åœ¨ AMQP åè®®ä¸­ï¼Œæˆ–è€… RabbitMQ æœ¬èº«æ²¡æœ‰ç›´æ¥æ”¯æŒå»¶è¿Ÿé˜Ÿåˆ—çš„åŠŸèƒ½ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡å‰é¢ æ‰€ä»‹ç»çš„ DLX å’Œ TTL æ¨¡æ‹Ÿå‡ºå»¶è¿Ÿé˜Ÿåˆ—çš„åŠŸèƒ½ã€‚æ‰€ä»¥åœ¨ä»‹ç»å»¶æ—¶é˜Ÿåˆ—ä¹‹å‰ï¼Œé¦–å…ˆä»‹ç»ä¸‹DLX(Dead-Letter-Exchange)å’ŒTTL(Time to Live)ã€‚ æ­»ä¿¡äº¤æ¢å™¨DLX(Dead-Letter-Exchange)DLXï¼šæ­»ä¿¡é˜Ÿåˆ—ï¼Œç”¨æ¥å­˜å‚¨æœ‰è¶…æ—¶æ—¶é—´ä¿¡æ¯çš„æ¶ˆæ¯ï¼Œ å¹¶ä¸”å¯ä»¥è®¾ç½®å½“æ¶ˆæ¯è¶…æ—¶æ—¶ï¼Œè½¬å‘åˆ°å¦ä¸€ä¸ªæŒ‡å®šé˜Ÿåˆ—(æ­¤å¤„è®¾ç½®è½¬å‘åˆ°router), æ— æ¶ˆè´¹è€…ï¼Œå½“æ¥æ”¶åˆ°å®¢æˆ·ç«¯æ¶ˆæ¯ä¹‹åï¼Œç­‰å¾…æ¶ˆæ¯è¶…æ—¶ï¼Œå°†æ¶ˆæ¯è½¬å‘åˆ°æŒ‡å®šçš„Routeré˜Ÿåˆ—ã€‚ Router: è½¬å‘é˜Ÿåˆ—ï¼Œç”¨æ¥æ¥æ”¶æ­»ä¿¡é˜Ÿåˆ—è¶…æ—¶æ¶ˆæ¯ï¼Œ å¦‚ä¸Šç¤ºä¾‹æ¶ˆæ¯ï¼Œåœ¨æ¥æ”¶åˆ°ä¹‹åï¼Œæ¶ˆè´¹è€…å°†æ¶ˆæ¯è§£æï¼Œè·å–queueNameï¼Œbody,å†å‘æ‰€è·å–çš„queueNameé˜Ÿåˆ—å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œå†…å®¹ä¸ºbody. å…·ä½“ä»£ç å®ç°: åœ¨æ¶ˆè´¹è€…é¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ªé…ç½®ç±»12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273package com.jiafly.rabbit.consumer.delay;import org.springframework.amqp.core.Binding;import org.springframework.amqp.core.BindingBuilder;import org.springframework.amqp.core.DirectExchange;import org.springframework.amqp.core.Queue;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import java.util.HashMap;/** * @author liuyi * @date 2018/12/2 12:44 AM */@Configurationpublic class DelayConfig &#123; /** * å®šä¹‰ä¸€ä¸ªäº¤æ¢æœº * * @return */ @Bean public DirectExchange delayExchange() &#123; return new DirectExchange("delay_exchange", true, false); &#125; /** * è½¬å‘é˜Ÿåˆ— * * @return */ @Bean public Queue routerQueue() &#123; return new Queue("router.queue", true, false, false); &#125; /** * è½¬å‘é˜Ÿåˆ—ç»‘å®šäº¤æ¢æœº * * @return */ @Bean public Binding routerBinding() &#123; return BindingBuilder.bind(routerQueue()).to(delayExchange()).with("router.routing.key"); &#125; /** * æ­»ä¿¡é˜Ÿåˆ— * * @return */ @Bean public Queue deadLetterQueue() &#123; HashMap&lt;String, Object&gt; arguments = new HashMap(16); arguments.put("x-dead-letter-exchange", "delay_exchange"); arguments.put("x-dead-letter-routing-key", "router.routing.key"); return new Queue("dead.letter.queue", true, false, false, arguments); &#125; /** * æ­»ä¿¡é˜Ÿåˆ—ç»‘å®šäº¤æ¢æœº * * @return */ @Bean public Binding deadLetterBinding() &#123; return BindingBuilder.bind(deadLetterQueue()).to(delayExchange()).with("dead.letter.routing.key"); &#125;&#125; åœ¨æ¶ˆè´¹è€…é¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ªæ¶ˆæ¯ç›‘å¬ç±»123456789101112131415161718192021package com.jiafly.rabbit.consumer.delay;import lombok.extern.slf4j.Slf4j;import org.springframework.amqp.rabbit.annotation.RabbitHandler;import org.springframework.amqp.rabbit.annotation.RabbitListener;import org.springframework.stereotype.Component;/** * @author liuyi * @date 2018/12/3 6:13 PM */@Component@Slf4jpublic class DelayConsumer &#123; @RabbitListener(queues = "router.queue") @RabbitHandler public void delayConsumer(String msg) &#123; log.info("delay.queue1æ¥æ”¶æ¶ˆæ¯:&#123;&#125;", msg); &#125;&#125; åœ¨ç”Ÿäº§è€…é¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ªæ¶ˆæ¯å‘é€controller12345678910111213141516171819202122232425262728293031323334353637package com.jiafly.rabbit.producer;import lombok.extern.slf4j.Slf4j;import org.springframework.amqp.core.AmqpTemplate;import org.springframework.amqp.support.converter.AbstractJavaTypeMapper;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.web.bind.annotation.PathVariable;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;/** * @author liuyi * @date 2018/12/3 7:17 PM */@RestController@RequestMapping()@Slf4jpublic class DelayProducer &#123; @Autowired private AmqpTemplate template; /** * å»¶è¿Ÿé˜Ÿåˆ— * @param msg æ¶ˆæ¯å†…å®¹ * @return æ¶ˆæ¯å†…å®¹ */ @RequestMapping("/delay/&#123;msg&#125;") public String delayProducerOne(@PathVariable("msg") String msg) &#123; log.info("delay:ç”Ÿäº§æ¶ˆæ¯:" + msg); template.convertAndSend("delay_exchange", "dead.letter.routing.key", msg, message -&gt; &#123; message.getMessageProperties().setExpiration(30 * 1000 + ""); return message; &#125;); return msg; &#125;&#125; æµ‹è¯•åˆ†åˆ«å¯åŠ¨ä¸¤ä¸ªé¡¹ç›®ï¼Œåœ¨æµè§ˆå™¨çš„è·¯å¾„ä¸Šè¾“å…¥ http://localhost:1180/delay/æµ‹è¯•æ¶ˆæ¯ ï¼Œå°±å¯åœ¨æ¶ˆè´¹è€…é¡¹ç›®ä¸­çœ‹åˆ°æ‰“å°çš„ä¿¡æ¯ã€‚ 30ç§’åå¯ä»¥çœ‹åˆ°æ¶ˆè´¹è€…ç®¡ç†åå°æœ‰åˆšåˆšå‘é€çš„æ¶ˆæ¯è¢«æ‰“å°å‡ºæ¥äº†ã€‚ æ¶ˆæ¯çš„æŒä¹…åŒ–ä¸ºäº†ä¿è¯RabbitMQåœ¨é‡å¯ã€å¥”æºƒç­‰å¼‚å¸¸æƒ…å†µä¸‹æ•°æ®æ²¡æœ‰ä¸¢å¤±ï¼Œé™¤äº†å¯¹æ¶ˆæ¯æœ¬èº«æŒä¹…åŒ–ä¸ºï¼Œè¿˜éœ€è¦å°†æ¶ˆæ¯ä¼ è¾“ç»è¿‡çš„é˜Ÿåˆ—(queue)ï¼Œäº¤äº’æœºè¿›è¡ŒæŒä¹…åŒ–(exchange)ï¼ŒæŒä¹…åŒ–ä»¥ä¸Šå…ƒç´ åï¼Œæ¶ˆæ¯æ‰ç®—çœŸæ­£RabbitMQé‡å¯ä¸ä¼šä¸¢å¤±ã€‚åˆ›å»ºæ—¶å€™çš„å‚æ•°: durableæ˜¯å¦æŒä¹…åŒ–ï¼Œå¦‚æœtrueï¼Œåˆ™æ­¤ç§é˜Ÿåˆ—å«æŒä¹…åŒ–é˜Ÿåˆ—ï¼ˆDurable queuesï¼‰ã€‚æ­¤é˜Ÿåˆ—ä¼šè¢«å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œå½“æ¶ˆæ¯ä»£ç†ï¼ˆbrokerï¼‰é‡å¯çš„æ—¶å€™ï¼Œå®ƒä¾æ—§å­˜åœ¨ã€‚æ²¡æœ‰è¢«æŒä¹…åŒ–çš„é˜Ÿåˆ—ç§°ä½œæš‚å­˜é˜Ÿåˆ—ï¼ˆTransient queuesï¼‰ã€‚ execulusiveè¡¨ç¤ºæ­¤å¯¹åº”åªèƒ½è¢«å½“å‰åˆ›å»ºçš„è¿æ¥ä½¿ç”¨ï¼Œè€Œä¸”å½“è¿æ¥å…³é—­åé˜Ÿåˆ—å³è¢«åˆ é™¤ã€‚æ­¤å‚è€ƒä¼˜å…ˆçº§é«˜äºdurable autoDeleteå½“æ²¡æœ‰ç”Ÿæˆè€…/æ¶ˆè´¹è€…ä½¿ç”¨æ­¤é˜Ÿåˆ—æ—¶ï¼Œæ­¤é˜Ÿåˆ—ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚(å³å½“æœ€åä¸€ä¸ªæ¶ˆè´¹è€…é€€è®¢åå³è¢«åˆ é™¤) è®¾ç½®æ¶ˆæ¯æŒä¹…åŒ–å¿…é¡»å…ˆè®¾ç½®é˜Ÿåˆ—æŒä¹…åŒ–ï¼Œè¦ä¸ç„¶é˜Ÿåˆ—ä¸æŒä¹…åŒ–ï¼Œæ¶ˆæ¯æŒä¹…åŒ–ï¼Œé˜Ÿåˆ—éƒ½ä¸å­˜åœ¨äº†ï¼Œæ¶ˆæ¯å­˜åœ¨è¿˜æœ‰ä»€ä¹ˆæ„ä¹‰ã€‚æ¶ˆæ¯æŒä¹…åŒ–éœ€è¦å°†äº¤æ¢æœºæŒä¹…åŒ–ã€é˜Ÿåˆ—æŒä¹…åŒ–ã€æ¶ˆæ¯æŒä¹…åŒ–ï¼Œæ‰èƒ½æœ€ç»ˆè¾¾åˆ°æŒä¹…åŒ–çš„ç›®çš„ã€‚å…¶å®åœ¨å‰é¢å°±å·²ç»ä½¿ç”¨æŒä¹…åŒ–äº†ã€‚æˆ‘ä»¬åœ¨ç®¡ç†åå°å»çœ‹ä¸€ä¸‹ã€‚ æ¶ˆæ¯çš„ç¡®è®¤ä¸æ‹’ç»æ¶ˆè´¹è€…åœ¨å¤„ç†æ¶ˆæ¯çš„æ—¶å€™å¶å°”ä¼šå¤±è´¥æˆ–è€…æœ‰æ—¶ä¼šç›´æ¥å´©æºƒæ‰ã€‚è€Œä¸”ç½‘ç»œåŸå› ä¹Ÿæœ‰å¯èƒ½å¼•èµ·å„ç§é—®é¢˜ï¼Œå¯¹äºæ­¤AMQPæœ‰ä¸¤ç§å¤„ç†æ–¹å¼ï¼š è‡ªåŠ¨ç¡®è®¤æ¨¡å¼:å½“RabbbitMQå°†æ¶ˆæ¯å‘é€ç»™åº”ç”¨åï¼Œæ¶ˆè´¹è€…ç«¯è‡ªåŠ¨å›é€ä¸€ä¸ªç¡®è®¤æ¶ˆæ¯ï¼Œæ­¤æ—¶RabbitMQåˆ é™¤æ­¤æ¶ˆæ¯ã€‚ æ˜¾å¼ç¡®è®¤æ¨¡å¼:æ¶ˆè´¹è€…æ”¶åˆ°æ¶ˆæ¯åï¼Œå¯ä»¥åœ¨æ‰§è¡Œä¸€äº›é€»è¾‘åï¼Œæ¶ˆè´¹è€…è‡ªå·±å†³å®šä»€ä¹ˆæ—¶å€™å‘é€ç¡®è®¤å›æ‰§ï¼ˆacknowledgementï¼‰ï¼ŒRabbitMQæ”¶åˆ°å›æ‰§åæ‰åˆ é™¤æ¶ˆæ¯ï¼Œè¿™æ ·å°±ä¿è¯æ¶ˆè´¹ç«¯ä¸ä¼šä¸¢å¤±æ¶ˆæ¯ å¦‚æœä¸€ä¸ªæ¶ˆè´¹è€…åœ¨å°šæœªå‘é€ç¡®è®¤å›æ‰§çš„æƒ…å†µä¸‹æŒ‚æ‰äº†ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¼šè¢«é‡æ–°æ”¾å…¥é˜Ÿåˆ—ï¼Œå¹¶ä¸”åœ¨è¿˜æœ‰å…¶ä»–æ¶ˆè´¹è€…å­˜åœ¨äºæ­¤é˜Ÿåˆ—çš„å‰æä¸‹ï¼Œç«‹å³æŠ•é€’ç»™å¦å¤–ä¸€ä¸ªæ¶ˆè´¹è€…ã€‚å¦‚æœå½“æ—¶æ²¡æœ‰å¯ç”¨çš„æ¶ˆè´¹è€…äº†ï¼Œæ¶ˆæ¯ä»£ç†ä¼šæ­»ç­‰ä¸‹ä¸€ä¸ªæ³¨å†Œåˆ°æ­¤é˜Ÿåˆ—çš„æ¶ˆè´¹è€…ï¼Œç„¶åå†æ¬¡å°è¯•æŠ•é€’ã€‚RabbitMQé‡Œçš„æ¶ˆæ¯æ˜¯ä¸ä¼šè¿‡æœŸã€‚å½“æ¶ˆè´¹è€…æŒ‚æ‰åï¼ŒRabbitMQä¼šä¸æ–­å°è¯•é‡æ¨ã€‚æ‰€æœ‰å•ä¸ªæ¶ˆæ¯çš„æ¨é€å¯èƒ½èŠ±è´¹å¾ˆé•¿çš„æ—¶é—´.]]></content>
      <categories>
        <category>æ¶ˆæ¯é˜Ÿåˆ—</category>
      </categories>
      <tags>
        <tag>rabbitMQ</tag>
        <tag>æ¶ˆæ¯é˜Ÿåˆ—</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[HashMapæºç é˜…è¯»(ä¸€)]]></title>
    <url>%2F2018%2F04%2F19%2FHashMap%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB(%E4%B8%80)%2F</url>
    <content type="text"><![CDATA[å‰è¨€æœ€è¿‘åœ¨çœ‹æ•°æ®ç»“æ„å’Œç®—æ³•çš„ä¸€äº›ä¸œè¥¿ï¼Œçœ‹åˆ°äº†çº¢é»‘æ ‘ï¼Œä¸å¾—ä¸è¯´çº¢é»‘æ ‘çœŸæ˜¯çš„æ¯”è¾ƒéš¾æ‡‚çš„ä¸€ç§æ•°æ®ç»“æ„äº†ã€‚èŠ±äº†ä¸¤å¤©æ—¶é—´ä¹Ÿåªæ˜¯æ‰å¼„æ‡‚ä¸€ç‚¹ï¼Œæ›´ä¸è¦è¯´å»åº”ç”¨å¥½å®ƒäº†ã€‚ä¹Ÿæ˜¯çªç„¶æƒ³åˆ°Javaåœ¨JDK1.8ç‰ˆæœ¬åï¼Œå¯¹HashMapåšäº†æ”¹è¿›ï¼Œåœ¨é“¾è¡¨é•¿åº¦å¤§äº8çš„æ—¶å€™ï¼Œå°†åé¢çš„æ•°æ®å­˜åœ¨çº¢é»‘æ ‘ä¸­ï¼Œä»¥åŠ å¿«æ£€ç´¢é€Ÿåº¦ã€‚äºæ˜¯æˆ‘å°±å¼€å§‹æ¥ç ”ç©¶ä¸‹HashMapçš„æºç ï¼Œä½¿ç”¨çš„å¼€å‘å·¥å…·æ˜¯ideaã€‚å…¶å®ä¹‹å‰ä¹Ÿé›¶æ˜Ÿçœ‹è¿‡ä¸€ç‚¹HashMapçš„æºç ï¼Œä½†æ˜¯ä¸€ç›´éƒ½æ²¡æœ‰æ€ä¹ˆæ·±å…¥çš„äº†è§£ä¸‹å»ï¼Œè¿™æ¬¡ä¹Ÿæ˜¯å€Ÿç€å·¥ä½œçš„éœ€æ±‚ä¸æ˜¯å¾ˆå¤šï¼ŒæŠ½å‡ºç‚¹ç©ºé—²æ—¶é—´æŠŠHashMapçš„æºç ç»™å•ƒä¸‹æ¥å§ã€‚å¤§å®¶ä¸€èµ·åŠ æ²¹å‘€ğŸ˜ æ­£æ–‡å“ˆå¸Œè¡¨åœ¨è¯´HashMapä¹‹å‰å‘¢ï¼Œæˆ‘ä»¬é¦–å…ˆæ¥äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯å“ˆå¸Œè¡¨ã€‚hash]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>HashMap</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Docker-01-Dockerä»‹ç»]]></title>
    <url>%2F2018%2F03%2F06%2Fdocker%2FDocker-01-docker%E4%BB%8B%E7%BB%8D%2F</url>
    <content type="text"><![CDATA[1.å‰è¨€1.1 ä»€ä¹ˆæ˜¯Dockerï¼ŸDockerä½¿ç”¨Googleå…¬å¸æ¨å‡ºçš„Goè¯­è¨€è¿›è¡Œå¼€å‘å®ç°ï¼ŒåŸºäºLinuxå†…æ ¸çš„cgroupï¼Œnamespaceï¼Œä»¥åŠ AUFSç±»çš„UnionFSç­‰æŠ€æœ¯ï¼Œå¯¹è¿›ç¨‹è¿›è¡Œå°è£…éš”ç¦»ï¼Œå±äºæ“ä½œç³»ç»Ÿå±‚é¢çš„è™šæ‹ŸåŒ–æŠ€æœ¯ã€‚ç”±äºéš”ç¦»çš„è¿›ç¨‹ç‹¬ç«‹äºå®¿ä¸»å’Œå…¶å®ƒçš„éš”ç¦»çš„è¿›ç¨‹ï¼Œå› æ­¤ä¹Ÿç§°å…¶ä¸ºå®¹å™¨ã€‚Dockeråœ¨å®¹å™¨çš„åŸºç¡€ä¸Šï¼Œè¿›è¡Œäº†è¿›ä¸€æ­¥çš„å°è£…ï¼Œä»æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œäº’è”åˆ°è¿›ç¨‹éš”ç¦»ç­‰ç­‰ï¼Œæå¤§çš„ç®€åŒ–äº†å®¹å™¨çš„åˆ›å»ºå’Œç»´æŠ¤ã€‚ä½¿å¾— DockeræŠ€æœ¯æ¯”è™šæ‹ŸæœºæŠ€æœ¯æ›´ä¸ºè½»ä¾¿ã€å¿«æ·ã€‚ä¼ ç»Ÿè™šæ‹ŸæœºæŠ€æœ¯æ˜¯è™šæ‹Ÿ å‡ºä¸€å¥—ç¡¬ä»¶åï¼Œåœ¨å…¶ä¸Šè¿è¡Œä¸€ä¸ªå®Œæ•´æ“ä½œç³»ç»Ÿï¼Œåœ¨è¯¥ç³»ç»Ÿä¸Šå†è¿è¡Œæ‰€éœ€åº”ç”¨è¿›ç¨‹;è€Œå®¹å™¨å†…çš„åº”ç”¨è¿›ç¨‹ç›´æ¥è¿è¡Œäºå®¿ä¸»çš„å†…æ ¸ï¼Œå®¹å™¨å†…æ²¡æœ‰è‡ªå·±çš„å†…æ ¸ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰è¿›è¡Œç¡¬ä»¶è™šæ‹Ÿã€‚å› æ­¤å®¹å™¨è¦æ¯”ä¼ ç»Ÿè™šæ‹Ÿæœºæ›´ä¸ºè½»ä¾¿ã€‚ 1.2 ä¸ºä»€ä¹ˆè¦ä½¿ç”¨dockerï¼Ÿä½œä¸ºä¸€ç§æ–°å…´çš„è™šæ‹ŸåŒ–æ–¹å¼ï¼ŒDocker è·Ÿä¼ ç»Ÿçš„è™šæ‹ŸåŒ–æ–¹å¼ç›¸æ¯”å…·æœ‰ä¼—å¤šçš„ä¼˜åŠ¿ã€‚ æ›´é«˜æ•ˆçš„åˆ©ç”¨ç³»ç»Ÿèµ„æº ç”±äºå®¹å™¨ä¸éœ€è¦è¿›è¡Œç¡¬ä»¶è™šæ‹Ÿä»¥åŠè¿è¡Œå®Œæ•´æ“ä½œç³»ç»Ÿç­‰é¢å¤–å¼€é”€ï¼ŒDockerå¯¹ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡æ›´é«˜ã€‚æ— è®ºæ˜¯åº”ç”¨æ‰§è¡Œé€Ÿåº¦ã€å†…å­˜æŸè€—æˆ–è€…æ–‡ä»¶å­˜å‚¨é€Ÿåº¦ï¼Œéƒ½è¦æ¯”ä¼ ç»Ÿè™šæ‹ŸæœºæŠ€æœ¯æ›´é«˜æ•ˆã€‚å› æ­¤ï¼Œç›¸æ¯”è™šæ‹ŸæœºæŠ€æœ¯ï¼Œä¸€ä¸ªç›¸åŒé…ç½®çš„ä¸»æœºï¼Œå¾€å¾€å¯ä»¥è¿è¡Œæ›´å¤šæ•°é‡çš„åº”ç”¨ã€‚ æ›´å¿«é€Ÿçš„å¯åŠ¨æ—¶é—´ ä¼ ç»Ÿçš„è™šæ‹ŸæœºæŠ€æœ¯å¯åŠ¨åº”ç”¨æœåŠ¡å¾€å¾€éœ€è¦æ•°åˆ†é’Ÿï¼Œè€ŒDockerå®¹å™¨åº”ç”¨ï¼Œç”±äºç›´æ¥è¿è¡Œäºå®¿ä¸»å†…æ ¸ï¼Œæ— éœ€å¯åŠ¨å®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼Œå› æ­¤å¯ä»¥åšåˆ°ç§’çº§ã€ç”šè‡³æ¯«ç§’çº§çš„å¯ åŠ¨æ—¶é—´ã€‚å¤§å¤§çš„èŠ‚çº¦äº†å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²çš„æ—¶é—´ã€‚ ä¸€è‡´çš„è¿è¡Œç¯å¢ƒ å¼€å‘è¿‡ç¨‹ä¸­ä¸€ä¸ªå¸¸è§çš„é—®é¢˜æ˜¯ç¯å¢ƒä¸€è‡´æ€§é—®é¢˜ã€‚ç”±äºå¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€ç”Ÿäº§ç¯å¢ƒä¸ä¸€è‡´ï¼Œå¯¼è‡´æœ‰äº› bugå¹¶æœªåœ¨å¼€å‘è¿‡ç¨‹ä¸­è¢«å‘ç°ã€‚è€ŒDockerçš„é•œåƒæä¾›äº†é™¤å†…æ ¸å¤–å®Œæ•´çš„è¿è¡Œæ—¶ç¯å¢ƒï¼Œç¡®ä¿äº†åº”ç”¨è¿è¡Œç¯å¢ƒä¸€è‡´æ€§ï¼Œä»è€Œä¸ä¼šå†å‡ºç° â€œè¿™æ®µä»£ç  åœ¨æˆ‘æœºå™¨ä¸Šæ²¡é—®é¢˜å•Šâ€ è¿™ç±»é—®é¢˜ã€‚ æŒç»­äº¤ä»˜å’Œéƒ¨ç½² ä½¿ç”¨Dockerå¯ä»¥é€šè¿‡å®šåˆ¶åº”ç”¨é•œåƒæ¥å®ç°æŒç»­é›†æˆã€æŒç»­äº¤ä»˜ã€éƒ¨ç½²ã€‚å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡Dockerfileæ¥è¿›è¡Œé•œåƒæ„å»ºï¼Œå¹¶ç»“åˆæŒç»­é›†æˆ(Continuous Integration)ç³»ç»Ÿè¿›è¡Œé›†æˆæµ‹è¯•ï¼Œè€Œè¿ç»´äººå‘˜åˆ™å¯ä»¥ç›´æ¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¿«é€Ÿéƒ¨ç½²è¯¥é•œåƒï¼Œç”šè‡³ç»“åˆ æŒç»­éƒ¨ç½²(Continuous Delivery/Deployment)ç³»ç»Ÿè¿›è¡Œè‡ªåŠ¨éƒ¨ç½²ã€‚ æ›´è½»æ¾çš„è¿ç§» ç”±äº Docker ç¡®ä¿äº†æ‰§è¡Œç¯å¢ƒçš„ä¸€è‡´æ€§ï¼Œä½¿å¾—åº”ç”¨çš„è¿ç§»æ›´åŠ å®¹æ˜“ã€‚Dockerå¯ä»¥åœ¨å¾ˆå¤šå¹³å°ä¸Šè¿è¡Œï¼Œæ— è®ºæ˜¯ç‰©ç†æœºã€è™šæ‹Ÿæœºã€å…¬æœ‰äº‘ã€ç§æœ‰äº‘ï¼Œç”šè‡³æ˜¯ç¬”è®°æœ¬ï¼Œå…¶è¿è¡Œç»“æœæ˜¯ä¸€è‡´çš„ã€‚å› æ­¤ç”¨æˆ·å¯ä»¥å¾ˆè½»æ˜“çš„å°†åœ¨ä¸€ä¸ªå¹³å°ä¸Šè¿è¡Œçš„åº”ç”¨ï¼Œè¿ç§»åˆ°å¦ä¸€ä¸ªå¹³å°ä¸Šï¼Œè€Œä¸ç”¨æ‹…å¿ƒè¿è¡Œç¯å¢ƒçš„å˜åŒ–å¯¼è‡´åº”ç”¨æ— æ³•æ­£å¸¸è¿è¡Œçš„æƒ…å†µã€‚ æ›´è½»æ¾çš„ç»´æŠ¤å’Œæ‰©å±• Docker ä½¿ç”¨çš„åˆ†å±‚å­˜å‚¨ä»¥åŠé•œåƒçš„æŠ€æœ¯ï¼Œä½¿å¾—åº”ç”¨é‡å¤éƒ¨åˆ†çš„å¤ç”¨æ›´ä¸ºå®¹æ˜“ï¼Œä¹Ÿä½¿å¾—åº”ç”¨çš„ç»´æŠ¤æ›´æ–°æ›´åŠ ç®€å•ï¼ŒåŸºäºåŸºç¡€é•œåƒè¿›ä¸€æ­¥æ‰©å±•é•œåƒä¹Ÿå˜å¾—éå¸¸ç®€å•ã€‚æ­¤å¤–ï¼ŒDockerå›¢é˜ŸåŒå„ä¸ªå¼€æºé¡¹ç›®å›¢é˜Ÿä¸€èµ·ç»´æŠ¤äº†ä¸€å¤§æ‰¹é«˜è´¨é‡çš„å®˜æ–¹é•œåƒï¼Œæ—¢å¯ä»¥ç›´æ¥åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼Œåˆå¯ä»¥ä½œä¸ºåŸºç¡€è¿›ä¸€æ­¥å®šåˆ¶ï¼Œå¤§å¤§çš„é™ä½äº†åº”ç”¨æœåŠ¡çš„é•œåƒåˆ¶ä½œæˆæœ¬ã€‚ å¯¹æ¯”ä¼ ç»Ÿè™šæ‹Ÿæœºæ€»ç»“ ç‰¹æ€§ å®¹å™¨ è™šæ‹Ÿæœº å¯åŠ¨ ç§’çº§ åˆ†é’Ÿçº§ ç¡¬ç›˜ä½¿ç”¨ ä¸€èˆ¬ä¸ºMB ä¸€èˆ¬ä¸ºGB æ€§èƒ½ æ¥è¿‘åŸç”Ÿ å¼±äº ç³»ç»Ÿæ”¯æŒé‡ å•æœºæ”¯æŒä¸Šåƒä¸ªå®¹å™¨ ä¸€èˆ¬å‡ åä¸ª 2. Dockerçš„å‡ ä¸ªåŸºæœ¬æ¦‚å¿µ2.1 Dockeré•œåƒ(image)æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ“ä½œç³»ç»Ÿåˆ†ä¸ºå†…æ ¸å’Œç”¨æˆ·ç©ºé—´ã€‚å¯¹äºLinuxè€Œè¨€ï¼Œå†…æ ¸å¯åŠ¨åï¼Œä¼šæŒ‚è½½æ–‡ä»¶ç³»ç»Ÿä¸ºå…¶æä¾›ç”¨æˆ·ç©ºé—´æ”¯æŒã€‚è€ŒDockeré•œåƒ(Image)ï¼Œå°±ç›¸å½“äºæ˜¯ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿã€‚æ¯”å¦‚å®˜æ–¹é•œåƒubuntu:14.04å°±åŒ…å«äº†å®Œæ•´çš„ä¸€å¥—Ubuntu14.04æœ€å°ç³»ç»Ÿçš„rootæ–‡ä»¶ç³»ç»Ÿã€‚ å› ä¸ºé•œåƒåŒ…å«æ“ä½œç³»ç»Ÿå®Œæ•´çš„rootæ–‡ä»¶ç³»ç»Ÿï¼Œå…¶ä½“ç§¯å¾€å¾€æ˜¯åºå¤§çš„ï¼Œå› æ­¤åœ¨Dockerè®¾è®¡æ—¶ï¼Œå°±å……åˆ†åˆ©ç”¨UnionFSçš„æŠ€æœ¯ï¼Œå°†å…¶è®¾è®¡ä¸ºåˆ†å±‚å­˜å‚¨çš„æ¶æ„ã€‚æ‰€ä»¥ä¸¥æ ¼æ¥è¯´ï¼Œé•œåƒå¹¶éæ˜¯åƒä¸€ä¸ªISOé‚£æ ·çš„æ‰“åŒ…æ–‡ä»¶ï¼Œé•œåƒåªæ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„æ¦‚å¿µï¼Œå…¶å®é™…ä½“ç°å¹¶éç”±ä¸€ä¸ªæ–‡ä»¶ç»„æˆï¼Œè€Œæ˜¯ç”±ä¸€ç»„æ–‡ä»¶ç³»ç»Ÿç»„æˆï¼Œæˆ–è€…è¯´æ˜¯ç”±å¤šå±‚æ–‡ä»¶ç³»ç»Ÿè”åˆç»„æˆã€‚ é•œåƒæ„å»ºæ—¶ï¼Œä¼šä¸€å±‚å±‚æ„å»ºï¼Œå‰ä¸€å±‚æ˜¯åä¸€å±‚çš„åŸºç¡€ã€‚æ¯ä¸€å±‚æ„å»ºå®Œå°±ä¸ä¼šå†å‘ç”Ÿæ”¹å˜ï¼Œåä¸€å±‚ä¸Šçš„ä»»ä½•æ”¹å˜åªå‘ç”Ÿåœ¨è‡ªå·±è¿™ä¸€å±‚ã€‚æ¯”å¦‚ï¼Œåˆ é™¤å‰ä¸€å±‚æ–‡ä»¶çš„æ“ä½œï¼Œå®é™…ä¸æ˜¯çœŸçš„åˆ é™¤å‰ä¸€å±‚çš„æ–‡ä»¶ï¼Œè€Œæ˜¯ä»…åœ¨å½“å‰å±‚æ ‡è®°ä¸ºè¯¥æ–‡ä»¶å·²åˆ é™¤ã€‚åœ¨æœ€ç»ˆå®¹å™¨è¿è¡Œçš„æ—¶å€™ï¼Œè™½ç„¶ä¸ä¼šçœ‹åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯å®é™…ä¸Šè¯¥æ–‡ä»¶ä¼šä¸€ç›´è·Ÿéšé•œåƒã€‚å› æ­¤ï¼Œåœ¨æ„å»ºé•œåƒçš„æ—¶å€™ï¼Œéœ€è¦é¢å¤–å°å¿ƒï¼Œæ¯ä¸€å±‚å°½é‡åªåŒ…å«è¯¥å±‚éœ€è¦æ·»åŠ çš„ä¸œè¥¿ï¼Œä»»ä½•é¢å¤–çš„ä¸œè¥¿åº”è¯¥åœ¨è¯¥å±‚æ„å»ºç»“æŸå‰æ¸…ç†æ‰ã€‚ åˆ†å±‚å­˜å‚¨çš„ç‰¹å¾è¿˜ä½¿å¾—é•œåƒçš„å¤ç”¨ã€å®šåˆ¶å˜çš„æ›´ä¸ºå®¹æ˜“ã€‚ç”šè‡³å¯ä»¥ç”¨ä¹‹å‰æ„å»ºå¥½çš„é•œåƒä½œä¸ºåŸºç¡€å±‚ï¼Œç„¶åè¿›ä¸€æ­¥æ·»åŠ æ–°çš„å±‚ï¼Œä»¥å®šåˆ¶è‡ªå·±æ‰€éœ€çš„å†…å®¹ï¼Œæ„å»ºæ–°çš„é•œåƒã€‚ 2.2 Dockerå®¹å™¨(container)é•œåƒ(image)å’Œå®¹å™¨(container)çš„å…³ç³»ï¼Œå°±åƒæ˜¯é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ä¸­çš„ç±»å’Œå®ä¾‹ä¸€æ ·ï¼Œé•œåƒæ˜¯é™æ€çš„å®šä¹‰ï¼Œå®¹å™¨æ˜¯é•œåƒè¿è¡Œæ—¶çš„å®ä½“ã€‚å®¹å™¨å¯ä»¥è¢«åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ã€åˆ é™¤ã€æš‚åœç­‰ã€‚ å®¹å™¨çš„å®è´¨æ˜¯è¿›ç¨‹ï¼Œä½†æ˜¯ä¸ç›´æ¥åœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œçš„è¿›ç¨‹ä¸åŒï¼Œå®¹å™¨è¿›ç¨‹è¿è¡Œäºå±äºè‡ªå·±çš„ç‹¬ç«‹çš„å‘½åç©ºé—´ã€‚å› æ­¤å®¹å™¨å¯ä»¥æ‹¥æœ‰è‡ªå·±çš„rootæ–‡ä»¶ç³»ç»Ÿã€è‡ªå·±çš„ç½‘ç»œé…ç½®ã€è‡ªå·±çš„è¿›ç¨‹ç©ºé—´ï¼Œç”šè‡³è‡ªå·±çš„ç”¨æˆ·IDç©ºé—´ã€‚å®¹å™¨å†…çš„è¿›ç¨‹æ˜¯è¿è¡Œåœ¨ä¸€ä¸ªéš”ç¦»çš„ç¯å¢ƒé‡Œï¼Œä½¿ç”¨èµ·æ¥ï¼Œå°±å¥½åƒæ˜¯åœ¨ä¸€ä¸ªç‹¬ç«‹äºå®¿ä¸»çš„ç³»ç»Ÿä¸‹æ“ä½œä¸€æ ·ã€‚ æ¯ä¸€ä¸ªå®¹å™¨è¿è¡Œæ—¶ï¼Œæ˜¯ä»¥é•œåƒä¸ºåŸºç¡€å±‚ï¼Œåœ¨å…¶ä¸Šåˆ›å»ºä¸€ä¸ªå½“å‰å®¹å™¨çš„å­˜å‚¨å±‚ï¼Œæˆ‘ä»¬å¯ä»¥ç§°è¿™ä¸ªä¸ºå®¹å™¨è¿è¡Œæ—¶è¯»å†™è€Œå‡†å¤‡çš„å­˜å‚¨å±‚ä¸ºå®¹å™¨å­˜å‚¨å±‚ã€‚å®¹å™¨å­˜å‚¨å±‚çš„ç”Ÿå­˜å‘¨æœŸå’Œå®¹å™¨ä¸€æ ·ï¼Œå®¹å™¨æ¶ˆäº¡æ—¶ï¼Œå®¹å™¨å­˜å‚¨å±‚ä¹Ÿéšä¹‹æ¶ˆäº¡ã€‚å› æ­¤ï¼Œä»»ä½•ä¿å­˜äºå®¹å™¨å­˜å‚¨å±‚çš„ä¿¡æ¯éƒ½ä¼šéšå®¹å™¨åˆ é™¤è€Œä¸¢å¤±ã€‚ å®¹å™¨ä¸åº”è¯¥å‘å…¶å­˜å‚¨å±‚å†…å†™å…¥ä»»ä½•æ•°æ®ï¼Œå®¹å™¨å­˜å‚¨å±‚è¦ä¿æŒæ— çŠ¶æ€åŒ–ã€‚æ‰€æœ‰çš„æ–‡ä»¶å†™å…¥æ“ä½œï¼Œéƒ½åº”è¯¥ä½¿ç”¨æ•°æ®å·(Volume)ã€æˆ–è€…ç»‘å®šå®¿ä¸»ç›®å½•ï¼Œåœ¨è¿™äº›ä½ç½®çš„è¯»å†™ä¼šè·³è¿‡å®¹å™¨å­˜å‚¨å±‚ï¼Œç›´æ¥å¯¹å®¿ä¸»(æˆ–ç½‘ç»œå­˜å‚¨)å‘ç”Ÿè¯»å†™ï¼Œå…¶æ€§èƒ½å’Œç¨³å®šæ€§æ›´é«˜ã€‚ æ•°æ®å·çš„ç”Ÿå­˜å‘¨æœŸç‹¬ç«‹äºå®¹å™¨ï¼Œå®¹å™¨æ¶ˆäº¡ï¼Œæ•°æ®å·ä¸ä¼šæ¶ˆäº¡ã€‚å› æ­¤ï¼Œä½¿ç”¨æ•°æ®å·åï¼Œå®¹å™¨å¯ä»¥éšæ„åˆ é™¤ã€é‡æ–°runï¼Œæ•°æ®å´ä¸ä¼šä¸¢å¤±ã€‚ 2.3 Dockerä»“åº“(registry)é•œåƒæ„å»ºå®Œæˆåï¼Œå¯ä»¥å¾ˆå®¹æ˜“çš„åœ¨å½“å‰å®¿ä¸»ä¸Šè¿è¡Œï¼Œä½†æ˜¯ï¼Œå¦‚æœéœ€è¦åœ¨å…¶å®ƒæœåŠ¡å™¨ä¸Šä½¿ç”¨è¿™ä¸ªé•œåƒï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªé›†ä¸­çš„å­˜å‚¨ã€åˆ†å‘é•œåƒçš„æœåŠ¡ï¼ŒDocker Registryå°±æ˜¯è¿™æ ·çš„æœåŠ¡ã€‚ ä¸‹é¢ä»¥Ubuntué•œåƒä¸ºä¾‹ï¼Œubuntuæ˜¯ä»“åº“çš„åå­—ï¼Œå…¶å†…åŒ…å«æœ‰ä¸åŒçš„ç‰ˆæœ¬æ ‡ç­¾ï¼Œå¦‚:14.04,16.04ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡ubuntu:14.04æˆ–è€…ubuntu:16.04æ¥å…·ä½“æŒ‡å®šæ‰€éœ€å“ªä¸ªç‰ˆæœ¬çš„é•œåƒã€‚å¦‚æœå¿½ç•¥äº†æ ‡ç­¾ï¼Œé‚£å°†è§†ä¸ºubuntu:latestã€‚ 2.3.1 å…¬æœ‰ä»“åº“æœ€å¸¸ä½¿ç”¨çš„å…¬æœ‰ä»“åº“æ˜¯DockerHubï¼Œè¿™ä¹Ÿæ˜¯é»˜è®¤çš„ä»“åº“ï¼Œæ‹¥æœ‰å¤§é‡çš„å®˜æ–¹é•œåƒã€‚è¿˜æœ‰è¿˜æœ‰CoreOSçš„Quay.ioï¼ŒGoogleçš„Google Container Registryï¼ŒKubernetes çš„é•œåƒä½¿ç”¨çš„å°±æ˜¯Googleçš„æœåŠ¡ã€‚ ç”±äºæŸäº›åŸå› ï¼Œåœ¨å›½å†…è®¿é—®è¿™äº›æœåŠ¡å¯èƒ½ä¼šæ¯”è¾ƒæ…¢ã€‚å›½å†…çš„ä¸€äº›äº‘æœåŠ¡å•†æä¾›äº†é’ˆå¯¹Docker Hubçš„é•œåƒæœåŠ¡(Registry Mirror)ï¼Œè¿™äº›é•œåƒæœåŠ¡è¢«ç§°ä¸ºåŠ é€Ÿå™¨ã€‚å¸¸è§çš„æœ‰:é˜¿é‡Œäº‘åŠ é€Ÿå™¨ã€DaoCloudåŠ é€Ÿå™¨ã€çµé›€äº‘åŠ é€Ÿå™¨ç­‰ã€‚ 2.3.2 ç§æœ‰ä»“åº“ç”¨æˆ·è¿˜å¯ä»¥åœ¨æœ¬åœ°æ­å»ºç§æœ‰Docker Registryã€‚Dockerå®˜æ–¹æä¾›äº†Docker Registryé•œåƒï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨åšä¸ºç§æœ‰RegistryæœåŠ¡ã€‚]]></content>
      <categories>
        <category>docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
</search>
